// Parser generated by redepage v0.2.2
'use strict;'
const { XsnSource, XsnArtifact, XsnName } = require( '../compiler/xsn-model' )
const AstBuildingParser = require('../parsers/AstBuildingParser')
const keywords={
abstract:0,
action:0,
actions:0,
all:1,
and:0,
annotate:0,
annotation:0,
any:1,
array:0,
as:1,
asc:0,
aspect:0,
association:0,
between:0,
by:1,
case:1,
cast:1,
columns:0,
composition:0,
context:0,
cross:0,
current:0,
default:0,
define:0,
definitions:0,
desc:0,
distinct:1,
element:0,
elements:0,
else:0,
end:0,
entity:0,
enum:0,
escape:0,
event:0,
exact:0,
except:0,
excluding:0,
exists:1,
extend:0,
false:1,
first:0,
floating:0,
following:0,
from:1,
full:0,
function:0,
group:0,
having:0,
in:1,
inner:0,
intersect:0,
into:0,
is:0,
join:0,
key:1,
last:0,
left:0,
like:0,
limit:0,
localized:0,
many:0,
masked:0,
minus:0,
mixin:0,
namespace:0,
new:0,
not:1,
null:1,
nulls:0,
of:1,
offset:0,
on:1,
one:0,
or:0,
order:0,
outer:0,
over:0,
parameters:0,
partition:0,
preceding:0,
projection:0,
redirected:0,
returns:0,
right:0,
row:0,
rows:0,
select:1,
service:0,
some:1,
stored:0,
then:0,
to:0,
true:1,
type:0,
unbounded:0,
union:0,
up:0,
using:0,
variable:0,
view:0,
virtual:0,
when:1,
where:1,
with:1,
}
const table=[
'start',
{
namespace:[2,16,,'namespaceRestriction'],
using:[2,19],
'@':[2,10,,,,'namespaceRestriction'],type:'@',view:'@',event:'@',action:'@',aspect:'@',define:'@',entity:'@',extend:'@',context:'@',service:'@',abstract:'@',annotate:'@',function:'@',annotation:'@',
'':3
},
{
';':['c',1],
EOF:3,
Id:['g',1,,'afterBrace'],'@':'Id',
},
['m',0,'EOF'],
'artifactsBlock',
['m',6,'{',,'init','afterBrace'],
{Id:[7,10],'@':'Id','':8},
{
';':['c',6],
'}':8,
Id:['g',6,,'afterBrace'],'@':'Id',
},
['m',0,'}',,,'afterBrace'],
'artifactDefOrExtend',
{'@':[10,778],'':11},
{
define:['ck',12],
type:12,view:12,event:12,action:12,aspect:12,entity:12,context:12,service:12,abstract:12,function:12,annotation:12,
extend:['ck',13,,'extensionRestriction'],
annotate:['ck',14,,'extensionRestriction'],
},
{
service:[0,43],
context:[0,48],
annotation:[0,53,,'vocabularyRestriction'],
type:[0,58],
aspect:[0,63],abstract:'aspect',
entity:[0,73],
view:[0,89,,'hide_'],
event:[0,101],
action:[0,113],
function:[0,119],
},
{
Id:[0,229],
service:[0,251,1],
context:[0,258,1,'hide_'],
type:[0,265,1,'hide_'],
aspect:[0,277,1,'hide_'],entity:'aspect',
projection:[0,288,1,'hide_'],
},
[0,216],
'namespaceDeclaration',
['mk',17,'namespace'],
[0,35],
'usingDeclaration',
['mk',20,'using'],
{
from:['ck',21],
Id:[22,31],
'{':24,
},
['m',0,'String'],
{from:['ck',23],'':0},
['m',0,'String'],
['m',25,'{'],
{Id:[26,31],'':27},
{
',':['c',25],
'}':27,
},
['m',28,'}',,,'afterBrace'],
{from:['ck',29],'':0},
['m',0,'String'],
'usingProxy',
[32,39],
{as:['ck',33],'':0},
['mi',0],
'namePath',
['mi',36],
{'.':['c',37],'':0},
['miA',36],
'simplePath',
['mi',40],
{'.':['c',41],'':0},
['miA',40],
'serviceDef',
['mk',44,'service',,,'vocabularyRestriction'],
[45,35],
{'@':[45,784],'':46},
{'{':[0,5],'':0},
'contextDef',
['mk',49,'context',,,'vocabularyRestriction'],
[50,35],
{'@':[50,784],'':51},
{'{':[0,5],'':0},
'annotationDef',
['mk',54,'annotation'],
[55,35],
{'@':[55,784],'':56},
[0,347],
'typeDef',
['mk',59,'type'],
[60,35],
{'@':[60,784],'':61},
[0,347],
'aspectDef',
{
aspect:['ck',65],
abstract:['ck',64,,'hide_'],
},
['mk',65,'entity'],
[66,35],
{'@':[66,784],'':67},
{
'{':[71,158],
':':['c',68],
'':0
},
{Id:[69,39],'':70},
{
',':['c',68],
'{':70,
'':0
},
[71,158],
{actions:[0,125],'':0},
'entityDef',
['mk',74,'entity'],
[75,35],
{'@':[75,784],'':76},
{'(':[77,142],'':77},
{
':':['c',78],
'{':81,
as:['ck',82],
},
{Id:79},
{Id:[80,39],'':81},
{
',':['c',79],
'{':81,
},
[87,158],
{
'(':[87,453],select:'(',
projection:['g',83,,,'sloppy','afterBrace'],
},
[84,447],
{group:[85,611],where:'group',having:'group','':85},
{limit:[86,623],order:'limit','':86},
['g',87,,,'normal','afterBrace'],
{actions:[0,125],'':0},
'viewDef',
['mk',90,'view'],
[91,35],
{'@':[91,784],'':92},
{
'(':[98,142],
with:['ck',93,,'hide_'],
'':98
},
['mk',94,'parameters'],
[95,147],
{',':['c',96],'':97},
[95,147],
['g',98],
['mk',99,'as'],
[0,453],
'eventDef',
['mk',102,'event'],
[103,35],
{'@':[103,784],'':104},
{
'{':[0,158],
':':['c',105],
},
{
'{':[0,158],
Id:[106,39],
projection:[0,447,1],
},
{',':107,'{':107,'':111},
{',':['c',108],'':110},
{Id:[109,39],'':110},
{
',':['c',108],
'{':110,
},
[0,158],
{'@':[111,778],'':0},
'actionMainDef',
['mk',114,'action'],
[115,35],
{'@':[115,784],'':116},
[117,142],
{returns:[0,154],'':0},
'functionMainDef',
['mk',120,'function'],
[121,35],
{'@':[121,784],'':122},
[123,142],
[0,154],
'actionsBlock',
['mk',126,'actions'],
['m',127,'{'],
{Id:[128,131],'@':'Id','':129},
{
';':['c',127],
'}':129,
Id:['g',127,,'afterBrace'],'@':'Id',
},
['m',0,'}',,,'afterBrace'],
'boundActionFunctionDef',
{'@':[131,778],'':132},
{
action:['ck',133],
function:['ck',137],
},
['mi',134],
{'@':[134,784],'':135},
[136,142],
{returns:[0,154],'':0},
['mi',138],
{'@':[138,784],'':139},
[140,142],
[0,154],
'paramsList',
['m',143,'('],
{Id:[144,147],'@':'Id','':145},
{
',':['c',143],
')':145,
},
['m',0,')'],
'paramDef',
{'@':[147,778],'':148},
['miA',149],
{'@':[149,784],'':150},
{
'{':[151,158],
':':['c',152],
},
{not:[0,440],null:'not','':0},
[0,358],
'returnsSpec',
['mk',155,'returns',,'default','elementRestriction'],
{'@':[155,778],'':156},
[0,358],
'elementsBlock',
['m',159,'{'],
{Id:[160,163],'@':'Id','':161},
{
';':['c',159],
'}':161,
Id:['g',159,,'afterBrace'],'@':'Id',
},
['m',0,'}',,,'afterBrace'],
'elementDef',
{'@':[163,778],'':164},
{virtual:['ck',165,1],'':165},
{key:['ck',166],'':166},
{masked:['ck',167,1,'hide_'],'':167},
{element:['ck',168,1,'hide_'],'':168},
['mi',169,,,'elem','elementRestriction'],
{'@':[169,784],'':170},
{
'{':[171,158],
':':['c',172],
'':173
},
{not:[173,440],null:'not','':173},
[173,358],
{'=':['c',174,,'elementRestriction','calc'],'':0},
[175,651],
{stored:['ck',176],'':176},
['g',177],
{'@':[177,778,,'elementRestriction','anno'],'':0},
'enumSymbolsBlock',
['mk',180,'enum'],
['m',181,'{'],
{Id:[182,185],'@':'Id','':183},
{
';':['c',181],
'}':183,
},
['m',0,'}',,,'afterBrace'],
'enumSymbolDef',
{'@':[185,778],'':186},
['mi',187],
{'@':[187,778],'':188},
{'=':['c',189],'':0},
{
String:['c',191],
Number:['c',191],
'+':['c',190],'-':'+',
Id:[191,775,,'hide_'],'#':'Id',QuotedLiteral:'Id',
},
['m',191,'Number'],
['g',192],
{'@':[192,778],'':0},
'foreignKeysBlock',
['m',195,'{'],
{Id:[196,199],'@':'Id','':197},
{
',':['c',195],
'}':197,
},
['m',0,'}'],
'foreignKeyDef',
{'@':[199,778],'':200},
[201,39],
{as:['ck',202],'':0},
['mi',0],
'mixinElementDef',
['mi',205],
['m',206,':'],
{
association:['ck',207],
composition:['ck',209],
},
{'[':[208,428],'':208},
['mk',211,'to'],
{'[':[210,428],'':210},
['mk',211,'of'],
{one:['ck',212,1,'noRepeatedCardinality'],many:'one','':212},
[213,39],
['mk',214,'on'],
[0,643],
'annotateArtifact',
[217,35],
{
':':['c',218],
with:['ck',223],
'':223
},
[219,35],
{with:['ck',220],'':220},
['g',221],
{'@':[221,778],'':222},
{'{':[0,321],'':0},
['g',224],
{'@':[224,778],'':225},
{'(':[226,308],'':226},
{
returns:[0,317],
'{':[227,321],
'':227
},
{actions:[0,296],'':0},
'extendArtifact',
[230,35],
{
':':['c',231],
with:['ck',240],
'':237
},
[232,35],
{with:['ck',233],'':233},
['g',234],
{'@':[234,778],'':235},
{
elements:['ck',236],
'{':236,
enum:[0,179],
'(':[0,419],
'':0
},
[0,331],
{'@':[237,778],'':238},
{'{':[239,331],'':0},
{actions:[0,125],'':0},
{'@':[240,778],'':241},
{
Id:[242,39],
elements:['ck',246,1],
'{':246,
actions:[0,125,1],
enum:[0,179,1],
'(':[0,419],
columns:['ck',248,1],
definitions:['ck',249,1],
'':0
},
{',':['c',243],'':244},
[242,39],
{'{':[245,331],'':245},
{actions:[0,125],'':0},
[247,331],
{actions:[0,125],'':0},
[0,560],
[0,5],
'extendService',
['mk',252,'service'],
[253,35],
{with:['ck',254],'':254},
['g',255],
{'@':[255,778],'':256},
{'{':[0,5],'':0},
'extendContext',
['mk',259,'context'],
[260,35],
{with:['ck',261],'':261},
['g',262],
{'@':[262,778],'':263},
{'{':[0,5],'':0},
'extendType',
['mk',266,'type'],
[267,35],
{with:['ck',270],'':268},
{'@':[268,778],'':269},
{'{':[0,331],'':0},
{'@':[270,778],'':271},
{
Id:[272,39],
elements:['ck',275,1],
'{':275,
enum:[0,179,1],
'(':[0,419],
'':0
},
{',':['c',273],'':274},
[272,39],
{'{':[0,331],'':0},
[0,331],
'extendEntityOrAspect',
{aspect:['ck',278],entity:'aspect'},
[279,35],
{with:['ck',281],'':280},
{'@':[280,778],'':285},
{'@':[281,778],'':282},
{
Id:[283,39],
actions:['g',285,1],
'':285
},
{',':['c',284],'':285},
[283,39],
{'{':[286,331],'':286},
{actions:[0,125],'':0},
'extendProjection',
['mk',289,'projection'],
[290,35],
{with:['ck',291],'':291},
['g',292],
{'@':[292,778],'':293},
{'{':[294,560],'':294},
{actions:[0,125],'':0},
'annotateActionsBlock',
['mk',297,'actions'],
['m',298,'{'],
{Id:[299,302],'@':'Id','':300},
{
';':['c',298],
'}':300,
Id:['g',298,,'afterBrace'],'@':'Id',
},
['m',0,'}',,,'afterBrace'],
'annotateBoundAction',
{'@':[302,778],'':303},
['mi',304],
{'@':[304,778],'':305},
{'(':[306,308],'':306},
{returns:[0,317,1],'':0},
'annotateParamsBlock',
['m',309,'('],
{Id:[310,313],'@':'Id','':311},
{
',':['c',309],
')':311,
},
['m',0,')'],
'annotateParam',
{'@':[313,778],'':314},
['mi',315],
{'@':[315,778],'':0},
'annotateReturns',
['mk',318,'returns'],
{'@':[318,778],'':319},
{'{':[0,321],'':0},
'annotateElementsBlock',
['m',322,'{'],
{Id:[323,326],'@':'Id','':324},
{
';':['c',322],
'}':324,
Id:['g',322,,'afterBrace'],'@':'Id',
},
['m',0,'}',,,'afterBrace'],
'annotateElement',
{'@':[326,778],'':327},
['mi',328],
{'@':[328,778],'':329},
{'{':[0,321],'':0},
'extendElementsBlock',
['m',332,'{'],
{Id:[333,336],'@':'Id','':334},
{
';':['c',332],
'}':334,
Id:['g',332,,'afterBrace'],'@':'Id',
},
['m',0,'}',,,'afterBrace'],
'elementDefOrExtend',
{'@':[336,778],'':337},
{
Id:[0,163],'@':'Id',key:'Id',
extend:['ck',338,1],
},
{element:['ck',339,1],'':339},
['mi',340],
{with:['ck',343],'':341},
{'@':[341,778],'':342},
{'{':[0,331],'':0},
{'@':[343,778],'':344},
{
elements:['ck',345],
'{':345,
enum:[0,179],
'(':[0,419],
'':0
},
[0,331],
'typeOrIncludesSpec',
{
'{':[348,158],
':':['c',349],
},
{not:[0,440],null:'not','':0},
{
projection:[0,447,1],
'{':[0,358,1],many:'{',type:'{',array:'{',localized:'{',association:'{',composition:'{',
Id:[350,39],
},
{
'(':[351,406],':':'(',
'@':[0,359],not:'@',enum:'@',null:'@',default:'@',
',':352,'{':352,
'':0
},
{'@':[0,359],not:'@',enum:'@',null:'@',default:'@','':0},
{',':['c',353],'':355},
{Id:[354,39],'':355},
{
',':['c',353],
'{':355,
},
[356,158],
{not:[0,440],null:'not','':0},
'typeExpression',
{
Id:[359,405],
type:[359,397,1],
localized:['ck',368,1],
association:['ck',370,1,,'calc','elementRestriction'],
composition:['ck',374,1,,'calc','elementRestriction'],
array:['ck',378,1,,'calc','elementRestriction'],
many:['ck',379,1,,'calc','elementRestriction'],
'{':[385,158,,,'calc','elementRestriction'],
},
['g',360],
{'@':[360,778],'':361},
{not:[362,440,,'elementRestriction','notNull'],null:'not','':363},
{'@':[362,778],'':363},
{
enum:[364,179,,,'anno','elementRestriction'],
'@':[0,394],not:'@',null:'@',default:'@',
'':0
},
{not:[365,440,,'elementRestriction','notNull'],null:'not','':365},
{default:['ck',366,,'elementRestriction','default'],'':367},
[367,651],
{not:[0,440,,'elementRestriction','notNull'],null:'not','':0},
[369,405],
{'@':[0,394],not:'@',null:'@',default:'@','':0},
{'[':[371,428],'':371},
['mk',372,'to'],
{one:['ck',373,1,'noRepeatedCardinality'],many:'one','':373},
[0,387],
{'[':[375,428],'':375},
['mk',376,'of'],
{one:['ck',377,1,'noRepeatedCardinality'],many:'one','':377},
{
Id:[0,387],
'{':[0,158],
},
['mk',379,'of'],
{
Id:[380,405],
type:[380,397,1],
'{':[384,158],
},
{not:[381,440,,'elementRestriction','notNull'],null:'not','':381},
{enum:[384,179],'':382},
{'@':[382,778],'':383},
['g',0,[]],
{not:[0,440,,'elementRestriction','notNull'],null:'not','':0},
{not:[0,440],null:'not','':0},
'typeAssocProperties',
[388,39],
{'@':[388,778],'':389},
{
on:['ck',390],
'{':[392,194],
'@':[0,394],not:'@',null:'@',default:'@',
'':0
},
[391,643],
{'@':[391,778],'':0},
{'@':[0,394],not:'@',null:'@',default:'@','':0},
'typeProperties',
{
'@':[394,778],
not:[394,440,,'elementRestriction','notNull'],null:'not',
default:['ck',395,,'elementRestriction','default'],
'':0
},
[394,651],
'typeTypeOf',
['mk',398,'type'],
['mk',399,'of'],
[400,39],
{':':['c',401],'':0},
['miA',402],
{'.':['c',403],'':0},
['miA',402],
'typeRefOptArgs',
[406,39],
{
':':['c',407],
'(':['c',411],
'':0
},
['miA',408],
{'.':['c',409],'':410},
['miA',408],
['g',0,[]],
{
Number:['c',412],
Id:415,
},
{',':['c',413],'':414},
{
Number:['c',412],
floating:['ck',412],variable:'floating',
')':414,
},
['g',417],
{Id:[416,424],'':417},
{
',':['c',415],
')':417,
},
['m',0,')'],
'typeNamedArgsList',
['m',420,'('],
{Id:[421,424],'':422},
{
',':['c',420],
')':422,
},
['m',0,')'],
'typeNamedArg',
['mi',425],
['m',426,':'],
{
Number:['c',0],
floating:['ck',0],variable:'floating',
},
'cardinality',
['m',429,'['],
{
'*':['c',430],
Number:['c',432],
'':434
},
{',':['c',431],'':434},
[434,436],
{
',':['c',433],
'..':[434,437],
'':434
},
[434,436],
['m',0,']'],
'targetCardinality',
{
'*':['c',0],
Number:['c',437],
},
{'..':['c',438],'':0},
{
'*':['c',0],
Number:['c',0],
},
'nullability',
{
null:['ck',0],
not:['ck',441],
},
['mk',0,'null'],
'queryEOF',
[444,453],
{';':['c',445],'':445},
['m',0,'EOF'],
'projectionSpec',
['mk',448,'projection'],
['mk',449,'on'],
[450,514],
{'{':[451,560],'':451},
{excluding:[0,553],'':0},
'queryExpression',
{
'(':['c',454],
Id:[456,463],
},
[455,453],
['m',456,')'],
{
intersect:['ck',457,,'precLeft_',4],
minus:['ck',457,,'precLeft_',2],except:'minus',
union:['ck',458,,'precLeft_',2],
'':460
},
{distinct:['ck',459],'':459},
{all:['ck',459],distinct:'all','':459},
[456,453],
{limit:['g',461,,'precPost_',0],order:'limit','':0},
[0,623],
'selectQuery',
['mk',464,'select'],
{
from:['ck',465],
all:['ck',475],distinct:'all',
Id:475,'#':475,'(':475,'*':475,'+':475,'-':475,':':475,'?':475,'@':475,'{':475,key:475,not:475,case:475,cast:475,null:475,true:475,false:475,Number:475,String:475,exists:475,QuotedLiteral:475,
},
[466,483],
{mixin:['ck',467],'':472},
['m',468,'{'],
{Id:[469,204],'':470},
{
';':['c',468],
'}':470,
},
['m',471,'}'],
['mk',472,'into'],
{all:['ck',473],distinct:'all','':473},
{'{':[474,560],'':474},
{excluding:[481,553],'':481},
['g',476,,,'sqlStyle','inSelectItem'],
{
'*':['c',477],
Id:[477,570],'#':'Id','(':'Id','+':'Id','-':'Id',':':'Id','?':'Id','@':'Id','{':'Id',Number:'Id',String:'Id',QuotedLiteral:'Id',
},
{',':['c',478],'':479},
{
'*':['c',477],
Id:[477,570],'#':'Id','(':'Id','+':'Id','-':'Id',':':'Id','?':'Id','@':'Id','{':'Id',Number:'Id',String:'Id',QuotedLiteral:'Id',
},
['mk',480,'from'],
[481,483],
{group:[0,611],where:'group',having:'group','':0},
'querySource',
[484,488],
{',':485,'':0},
{',':['c',486],'':0},
[485,488],
'tableExpression',
{
'(':[489,501],
Id:[490,514],
},
['g',490],
{
cross:['ck',491],
inner:['ck',494],
full:['ck',493],left:'full',right:'full',
join:['ck',496],
'':0
},
['mk',492,'join'],
{
'(':[490,501],
Id:[490,514],
},
{outer:['ck',494],'':494},
{one:[495,508],many:'one',exact:'one','':495},
['mk',496,'join'],
['g',497],
[498,488],
['mk',499,'on'],
[490,643],
'tableOrQueryParens',
['m',502,'(',,,'queryOnLeft'],
{
'(':[503,501],
Id:[504,488,,,'table','queryOnLeft'],
select:[504,453],
},
{
full:[504,489,,,'table','queryOnLeft'],join:'full',left:'full',cross:'full',inner:'full',right:'full',
limit:[504,456,,'queryOnLeft'],minus:'limit',order:'limit',union:'limit',except:'limit',intersect:'limit',
'':504
},
['m',505,')'],
{
as:['ck',506,,'queryOnLeft','table'],
Id:['ci',0,,'queryOnLeft','tableWithoutAs'],
'':0
},
['mi',0],
'joinCardinality',
{
exact:['ck',509],
one:509,
many:['ck',510],
},
['mk',510,'one'],
['mk',511,'to'],
{
exact:['ck',512],
one:512,
many:['ck',0],
},
['mk',0,'one'],
'fromRefWithOptAlias',
[515,521],
{':':['c',516],'':517},
[517,521],
{
as:['ck',518],
Id:['ci',0],
'':519
},
['mi',0],
['g',0,[]],
'fromPath',
['mi',522],
{'(':[523,527],'[':'(','':523},
{'.':['c',524,,'notAfterEntityArgOrFilter'],'':0},
['miA',525],
{'(':[523,527],'[':'(','':523},
'fromArgumentsAndFilter',
{'(':['c',528],'':532},
{Id:529},
{Id:[530,534],'':531},
{
',':['c',529],
')':531,
},
['m',532,')'],
{'[':[0,538],'':0},
'fromNamedArgument',
['mi',535],
['m',536,':'],
[0,651],
'cardinalityAndFilter',
['m',539,'['],
{Number:['c',540,,'beforeColon'],'':541},
['m',541,':'],
[542,544],
['m',0,']'],
'filterClauses',
{
where:['ck',545],
Id:545,'#':545,'(':545,'+':545,'-':545,':':545,'?':545,not:545,case:545,cast:545,null:545,true:545,false:545,Number:545,String:545,exists:545,QuotedLiteral:545,
group:['g',546,1],limit:'group',order:'group',having:'group',
'':546
},
[546,643],
{group:['g',547,,'hide_'],'':548},
[548,617],
{having:['ck',549,,'hide_'],'':550},
[550,643],
{limit:['g',551,,'hide_'],order:'limit','':0},
[0,623],
'excludingClause',
['mk',554,'excluding'],
['m',555,'{'],
{Id:556},
{Id:['ciA',557],'':558},
{
',':['c',556],
'}':558,
},
['m',0,'}',,,'afterBrace'],
'selectItemsList',
['m',561,'{',,'top','inSelectItem'],
{
'*':['c',562],
Id:[562,570],'#':'Id','(':'Id','+':'Id','-':'Id',':':'Id','?':'Id','@':'Id','{':'Id',Number:'Id',String:'Id',QuotedLiteral:'Id',
'':563
},
{
',':['c',561],
'}':563,
},
['m',0,'}',,,'afterBrace'],
'nestedSelectItemsList',
['m',566,'{',,,'inSelectItem'],
{
'*':['c',567],
Id:[567,570],'#':'Id','(':'Id','+':'Id','-':'Id',':':'Id','?':'Id','@':'Id','{':'Id',Number:'Id',String:'Id',QuotedLiteral:'Id',
'':568
},
{
',':['c',566],
'}':568,
},
['m',0,'}',,,'afterBrace'],
'selectItemDef',
{'@':[570,781],'':571},
{virtual:['ck',572,1,'modifierRestriction'],'':572},
['g',573,,,'key','columnExpr'],
{key:['ck',574,,'modifierRestriction'],'':574},
{
'#':[575,651,1],'(':'#','+':'#','-':'#',':':'#','?':'#',new:'#',not:'#',case:'#',cast:'#',null:'#',true:'#',false:'#',Number:'#',String:'#',exists:'#',QuotedLiteral:'#',
Id:[577,645],
'{':[588,565],
},
{
as:['ck',576],
Id:['ci',585],
'':585
},
['mi',585],
{
over:['ck',578],
'*':[580,652],'+':'*','-':'*','/':'*','<':'*','=':'*','>':'*','?':'*','!=':'*','<=':'*','<>':'*','==':'*','>=':'*',in:'*',is:'*',or:'*','||':'*',and:'*',not:'*',like:'*',between:'*',
as:['ck',582],
Id:['ci',585,,,,'nestedExpand'],
'.':['c',583],
'':585
},
[579,739],
{'*':[580,652],'+':'*','-':'*','/':'*','<':'*','=':'*','>':'*','?':'*','!=':'*','<=':'*','<>':'*','==':'*','>=':'*',in:'*',is:'*',or:'*','||':'*',and:'*',not:'*',like:'*',between:'*','':580},
{
as:['ck',581],
Id:['ci',585],
'':585
},
['mi',585],
['mi',585,,,,'nestedExpand'],
{
'{':[584,565],
'*':['c',0],
},
{excluding:[0,553],'':0},
{'{':['g',586,,'nestedExpand'],'':591},
[587,565],
{excluding:[591,553],'':591},
{excluding:[589,553],'':589},
['mk',590,'as'],
['mi',591],
['g',592,,,,'columnExpr'],
{'@':[592,784],'':593},
{':':['c',594],'':0},
{
type:[608,397,1],
localized:['ck',595,1],
Id:595,
redirected:['ck',596,1],
association:['ck',600,1,'columnExpr'],
composition:['ck',602,1,'columnExpr'],
},
[608,405],
['mk',597,'to'],
[598,39],
{
on:['ck',599],
'{':[608,194],
'':608
},
[608,643],
{'[':[601,428],'':601},
['mk',604,'to'],
{'[':[603,428],'':603},
['mk',604,'of'],
{one:['ck',605,1,'noRepeatedCardinality'],many:'one','':605},
[606,39],
['mk',607,'on'],
[608,643],
['g',609],
{'@':[609,778],'':0},
'whereGroupByHaving',
{where:['ck',612],'':613},
[613,643],
{group:[614,617],'':614},
{having:['ck',615],'':0},
[0,643],
'groupByClause',
['mk',618,'group'],
['mk',619,'by'],
[620,651],
{',':['c',621],'':0},
[620,651],
'orderByLimitOffset',
{order:[624,629],'':624},
{limit:['ck',625],'':0},
[626,651],
{offset:['ck',627],'':0},
[0,651],
'orderByClause',
['mk',630,'order'],
['mk',631,'by'],
[632,635],
{',':['c',633],'':0},
[632,635],
'orderByExpression',
[636,651],
{asc:['ck',637],desc:'asc','':637},
{nulls:['ck',638],'':0},
{last:['ck',0],first:'last'},
'conditionEOF',
[641,651],
['m',0,'EOF'],
'condition',
[0,651],
'valuePath',
['mi',646],
{'(':[647,712],'[':'(','':647},
{'.':['c',648,,'isDotForPath'],'':0},
['miA',649],
{'(':[647,712],'[':'(','':647},
'expression',
{
'(':[652,679],
'#':[662,775],null:'#',true:'#',false:'#',Number:'#',String:'#',QuotedLiteral:'#',
':':['c',653],
'?':['c',662,,'hide_'],
Id:[655,645],
new:[662,691,1],
exists:['ck',658],
case:[662,694],
cast:[662,705],
'+':['c',661,,'precRight_',30],'-':'+',
not:['ck',661,,'precRight_',8],
},
['g',662],
{
Id:['ciA',654],
Number:['c',662,,'hide_'],
},
{'.':[662,647],'':662},
{over:['ck',656],'':657},
[657,739],
['g',662],
{
'(':['c',659],
Id:[662,645],
'?':['c',662,,'hide_'],
},
[660,453],
['m',662,')'],
[662,651],
{
'*':['c',666,,'precLeft_',24],'/':'*',
'+':['c',666,,'precLeft_',22],'-':'+',
'||':['c',666,,'precLeft_',20],
and:['ck',666,,'precLeft_',4],
or:['ck',666,,'precLeft_',2],
'?':['c',663,,'precLeft_',0],
'<':['c',665,,'precNone_',10],'=':'<','>':'<','!=':'<','<=':'<','<>':'<','>=':'<',
'==':['c',666,,'precNone_',10],
is:['ck',667,,'precNone_',10],
not:['ck',669,,'isNegatedRelation','10'],
in:['g',669,,'precNone_',10],like:'in',between:'in',
'':0
},
[664,651],
['m',666,':'],
{all:['ck',666],any:'all',some:'all','':666},
[677,651],
{not:['ck',668],'':668},
['mk',677,'null'],
{
between:['ck',670],
in:['ck',673],
like:['ck',674],
},
[671,651],
['mk',672,'and'],
[677,651],
[677,651],
[675,651],
{escape:['ck',676],'':677},
[677,651],
['g',662],
'expressionOrQueryParens',
['m',680,'(',,,'queryOnLeft'],
{
'(':[681,679],
Id:[683,651,,,'expr','queryOnLeft'],'#':'Id','+':'Id','-':'Id',':':'Id','?':'Id',not:'Id',case:'Id',cast:'Id',null:'Id',true:'Id',false:'Id',Number:'Id',String:'Id',exists:'Id',QuotedLiteral:'Id',
select:[684,453],
},
{
'*':[682,652,,,'expr','queryOnLeft'],'+':'*','-':'*','/':'*','<':'*','=':'*','>':'*','?':'*','!=':'*','<=':'*','<>':'*','==':'*','>=':'*',in:'*',is:'*',or:'*','||':'*',and:'*',not:'*',like:'*',between:'*',
',':[684,686,,,'expr','queryOnLeft'],
limit:[684,456,,'queryOnLeft'],minus:'limit',order:'limit',union:'limit',except:'limit',intersect:'limit',
'':684
},
{',':[684,686],'':684},
{',':[684,686],'':684},
['m',0,')'],
'continueExpressionslist',
['m',687,','],
{Id:688,'#':688,'(':688,'+':688,'-':688,':':688,'?':688,not:688,case:688,cast:688,null:688,true:688,false:688,Number:688,String:688,exists:688,QuotedLiteral:688},
{Id:[689,651],'#':'Id','(':'Id','+':'Id','-':'Id',':':'Id','?':'Id',not:'Id',case:'Id',cast:'Id',null:'Id',true:'Id',false:'Id',Number:'Id',String:'Id',exists:'Id',QuotedLiteral:'Id','':0},
{',':['c',688],'':0},
'newAndValuePath',
['mk',692,'new'],
[0,645],
'caseExpression',
['mk',695,'case'],
{Id:[696,651],'#':'Id','(':'Id','+':'Id','-':'Id',':':'Id','?':'Id',not:'Id',case:'Id',cast:'Id',null:'Id',true:'Id',false:'Id',Number:'Id',String:'Id',exists:'Id',QuotedLiteral:'Id','':696},
{when:697},
{when:['ck',698],'':701},
[699,651],
['mk',700,'then'],
[697,651],
{else:['ck',702],'':703},
[703,651],
['mk',0,'end'],
'castFunction',
['mk',706,'cast'],
['m',707,'('],
[708,651],
['mk',709,'as'],
[710,405],
['m',0,')'],
'argumentsAndFilter',
{'(':['c',713,,,,'prepareSpecialFunction'],'':732},
{Id:['ciA',714,,'isNamedArg'],'':725},
{
':':['c',715],
'=>':['c',720],
},
[716,651],
{',':['c',717],'':731},
{
Id:['ciA',718],
')':731,
},
['m',719,':'],
[716,651],
[721,651],
{',':['c',722],'':731},
{
Id:['ciA',723],
')':731,
},
['m',724,'=>'],
[721,651],
{Id:[726,734],'#':'Id','(':'Id','*':'Id','+':'Id','-':'Id',':':'Id','?':'Id',Id_all:'Id',Number:'Id',String:'Id',QuotedLiteral:'Id',DeleteStarFromSet:'Id','':731},
{',':['c',727,,,,'nextFunctionArgument'],'':728},
{
Id:[726,734],'#':'Id','(':'Id','*':'Id','+':'Id','-':'Id',':':'Id','?':'Id',not:'Id',case:'Id',cast:'Id',null:'Id',true:'Id',false:'Id',Id_all:'Id',Number:'Id',String:'Id',exists:'Id',QuotedLiteral:'Id',DeleteStarFromSet:'Id',
')':['g',728,1,'atRightParen'],order:')',
},
{order:['ck',729],'':731},
['mk',730,'by'],
[731,754],
['m',732,')'],
{'[':[0,538],'':0},
'funcExpression',
{
' lookahead':'lGenericIntroOrExpr',
Id:[736,651],'#':'Id','(':'Id','+':'Id','-':'Id',':':'Id','?':'Id',Number:'Id',String:'Id',QuotedLiteral:'Id',
GenericExpr:['ckA',736],
GenericIntro:['ckA',735],
},
[736,651],
{
' lookahead':'lGenericSeparator',
GenericSeparator:['ckA',737],
'':0
},
{
' lookahead':'lGenericExpr',
Id:[736,651],'#':'Id','(':'Id','+':'Id','-':'Id',':':'Id','?':'Id',Number:'Id',String:'Id',QuotedLiteral:'Id',
GenericExpr:['ckA',736],
},
'overClause',
['m',740,'('],
{partition:['ck',741],'':743},
['mk',742,'by'],
[743,750],
{order:['ck',744],'':746},
['mk',745,'by'],
[746,754],
{rows:['ck',747],'':748},
[748,763],
['m',0,')'],
'expressionsAsXpr',
[751,651],
{',':['c',752],'':0},
[751,651],
'orderByClauseAsXpr',
[755,758],
{',':['c',756],'':0},
[755,758],
'orderBySpecAsXpr',
[759,651],
{asc:['ck',760],desc:'asc','':760},
{nulls:['ck',761],'':0},
{last:['ck',0],first:'last'},
'windowFrameClause',
{
unbounded:['ck',764],
Number:['c',764],
current:['ck',765],
between:['ck',766],
},
['mk',0,'preceding'],
['mk',0,'row'],
[767,770],
['mk',768,'and'],
[0,770],
'windowFrameBoundSpec',
{
unbounded:['ck',771],
Number:['c',771],
current:['ck',773],
},
{
following:['ck',772],
preceding:['ck',772],
},
['g',0,[]],
['mk',0,'row'],
'literalValue',
{
'#':['c',776],
null:['ck',0],
true:['ck',0],false:'true',
Number:['c',0],
String:['c',0],
QuotedLiteral:['c',0],
},
['miA',0],
'annoAssignStd',
['m',779,'@',,,'annoInSameLine'],
{
'(':[0,787],
Id:[0,792],
},
'annoAssignCol',
['m',782,'@'],
{
'(':[0,787],
Id:[0,792],
},
'annoAssignMid',
['m',785,'@',,,'annoInSameLine'],
{
'(':[0,787],
Id:[0,796],
},
'annoAssignParen',
['m',788,'(',,,'annoInSameLine'],
{Id:[789,792],'':790},
{
',':['c',788],
')':790,
},
['m',0,')'],
'annoAssignBase',
[793,796],
{':':['c',794,,'annoInSameLine'],'':0},
[0,818],
'annoNamePath',
['miA',797],
{'.':['c',798],'':800},
{
Id:['ciA',797],
'@':['c',799],
},
['miA',797],
{'#':[0,809,,'annoInSameLine'],'':0},
'annoPath',
{
Id:['ciA',804],
'@':['c',803],
},
['miA',804],
{'.':['c',805],'':807},
{
Id:['ciA',804],
'@':['c',806],
},
['miA',804],
{'#':[0,809],'':0},
'annoPathVariant',
['m',810,'#'],
['miA',811],
{'.':['c',812],'':0},
['miA',811],
'annoStructValue',
[815,802],
{':':['c',816],'':0},
[0,818],
'annoValue',
{
'#':[0,775],null:'#',true:'#',false:'#',Number:'#',String:'#',QuotedLiteral:'#',
'+':['c',819],'-':'+',
Id:[0,802],'@':'Id',
'{':['c',820],
'[':['c',824,,,,'arrayAnno'],
'(':['c',831],
},
['m',0,'Number'],
{Id:[821,814],'@':'Id','':822},
{
',':['c',820],
'}':822,
Id:['g',820,,'fail'],'@':'Id',
},
['g',823],
['m',0,'}'],
{
Id:[828,818],'#':'Id','(':'Id','+':'Id','-':'Id','@':'Id','[':'Id','{':'Id',Number:'Id',String:'Id',QuotedLiteral:'Id',
'...':['c',825,,'arrayAnno','ellipsis'],
'':829
},
{up:['ck',826],'':828},
['mk',827,'to'],
[828,818],
{
',':['c',824],
']':829,
},
['g',830],
['m',0,']'],
[832,643],
['m',0,')'],
]
class CdlParser extends AstBuildingParser{
constructor(lexer,...args){super(lexer,keywords,table,...args)}
start($,$next){
$.source??=new XsnSource( 'cdl' )
this.rule_(1,$next)
{ this.afterBrace( null, 'init' ); }
for(;;)switch(this.s){
case 1:switch(this.lk()){
case'namespace':this.gc(3,'namespaceRestriction')&&this.namespaceDeclaration({source:$.source},2);continue
case'using':this.usingDeclaration({source:$.source},2);continue
case'@':case'type':case'view':case'event':case'action':case'aspect':case'define':case'entity':case'extend':case'context':case'service':case'abstract':case'annotate':case'function':case'annotation':if(this.artifactDefOrExtend({outer:$.source},2)){this.namespaceRestriction()}continue;
default:this.s=3;continue
}
case 2:switch(this.l()){
case';':this.c(1);continue
case'EOF':this.s=3;continue
case'Id':case'@':if(this.ec('afterBrace')&&this.g(1)){ this.noAssignmentInSameLine(); }continue
default:this.e();continue
}
case 3:if(this.m(0,'EOF')){ this.docComment( null ); }continue
default:return this.exit_()
}
}
artifactsBlock($,$next){
this.rule_(5,$next)
for(;;)switch(this.s){
case 5:if(this.m(6,'{')){this.afterBrace(0,'init'); $.art.artifacts = this.createDict( $.start ); $.art.extensions = []; }continue
case 6:switch(this.l()){
case'Id':case'@':this.artifactDefOrExtend({outer:$.art},7);continue
default:this.s=8;continue
}
case 7:switch(this.l()){
case';':this.c(6);continue
case'}':this.s=8;continue
case'Id':case'@':if(this.ec('afterBrace')&&this.g(6)){ this.noAssignmentInSameLine(); }continue
default:this.e();continue
}
case 8:if(this.m(0,'}')){this.afterBrace(); this.finalizeDictOrArray( $.art.artifacts ); }continue
default:return this.exit_()
}
}
artifactDefOrExtend($,$next){
let art=new XsnArtifact()
this.rule_(10,$next)
{ art.location = this.startLocation();
this.docComment( art ); }
for(;;)switch(this.s){
case 10:switch(this.l()){
case'@':this.annoAssignStd({art},10);continue
default:this.s=11;continue
}
case 11:switch(this.lk()){
case'define':this.ck(12);continue
case'type':case'view':case'event':case'action':case'aspect':case'entity':case'context':case'service':case'abstract':case'function':case'annotation':this.s=12;continue
case'extend':if(this.ec('extensionRestriction')&&this.ck(13)){ art.kind = 'extend'; }continue
case'annotate':this.ec('extensionRestriction')&&this.ck(14);continue
default:this.e();continue
}
case 12:switch(this.lk()){
case'service':this.serviceDef({art,outer:$.outer},0);continue
case'context':this.contextDef({art,outer:$.outer},0);continue
case'annotation':this.ec('vocabularyRestriction')&&this.annotationDef({art,outer:$.outer},0);continue
case'type':this.typeDef({art,outer:$.outer},0);continue
case'aspect':case'abstract':this.aspectDef({art,outer:$.outer},0);continue
case'entity':this.entityDef({art,outer:$.outer},0);continue
case'view':this.viewDef({art,outer:$.outer},0);continue
case'event':this.eventDef({art,outer:$.outer},0);continue
case'action':this.actionMainDef({art,outer:$.outer},0);continue
case'function':this.functionMainDef({art,outer:$.outer},0);continue
default:this.e();continue
}
case 13:switch(this.lk()){
case'Id':this.extendArtifact({art,outer:$.outer},0);continue
case'service':this.lP()&&this.extendService({art,outer:$.outer},0);continue
case'context':this.lP()&&this.extendContext({art,outer:$.outer},0);continue
case'type':this.lP()&&this.extendType({art,outer:$.outer},0);continue
case'aspect':case'entity':this.lP()&&this.extendEntityOrAspect({art,outer:$.outer},0);continue
case'projection':this.lP()&&this.extendProjection({art,outer:$.outer},0);continue
default:this.ei();continue
}
case 14:this.annotateArtifact({art,outer:$.outer},0);continue
default:return this.exit_()
}
}
namespaceDeclaration($,$next){
let name;let _
this.rule_(16,$next)
for(;;)switch(this.s){
case 16:this.mk(17,'namespace');continue
case 17:if(this.namePath(_={category:'Namespace'},0)){name=_.name; $.source.namespace ??= { kind: 'namespace', name: name }; }continue
default:
this.attachLocation( $.source.namespace )
return this.exit_()
}
}
usingDeclaration($,$next){
let decl={ kind: 'using' }
this.rule_(19,$next)
for(;;)switch(this.s){
case 19:this.mk(20,'using');continue
case 20:switch(this.lk()){
case'from':this.ck(21);continue
case'Id':this.usingProxy({outer:$.source,proxy:decl},22);continue
case'{':this.s=24;{ $.source.usings.push( decl ); }continue
default:this.ei();continue
}
case 21:if(this.m(0,'String')){ $.source.dependencies.push( this.quotedLiteral() ); }continue
case 22:switch(this.lk()){
case'from':this.ck(23);continue
default:this.gr([';']);continue
}
case 23:if(this.m(0,'String')){ $.source.dependencies.push( decl.fileDep = this.quotedLiteral() ); }continue
case 24:if(this.m(25,'{')){ decl.usings = this.createArray(); }continue
case 25:switch(this.l()){
case'Id':this.usingProxy({outer:decl,proxy:{ kind: 'using' }},26);continue
default:this.s=27;continue
}
case 26:switch(this.l()){
case',':this.c(25);continue
case'}':this.s=27;continue
default:this.e();continue
}
case 27:if(this.m(28,'}')){this.afterBrace(); this.finalizeDictOrArray( decl.usings ); }continue
case 28:switch(this.lk()){
case'from':this.ck(29);continue
default:this.gr([';']);continue
}
case 29:if(this.m(0,'String')){ $.source.dependencies.push( decl.fileDep = this.quotedLiteral() ); }continue
default:
this.attachLocation( decl )
return this.exit_()
}
}
usingProxy($,$next){
let extern;let _
this.rule_(31,$next)
for(;;)switch(this.s){
case 31:if(this.simplePath(_={category:'global'},32)){extern=_.ref; $.proxy.extern = extern; $.outer.usings.push( $.proxy ); }continue
case 32:switch(this.lk()){
case'as':this.ck(33);continue
default:if(this.gr([])){ this.classifyImplicitName( 'Using' ); }continue
}
case 33:if(this.mi(0,'UsingAlias')){ $.proxy.name = this.identAst(); }continue
default:
this.attachLocation( $.proxy )
return this.exit_()
}
}
namePath($,$next){
$.name??=new XsnName()
this.rule_(35,$next)
for(;;)switch(this.s){
case 35:if(this.mi(36,$.category)){ $.name.path = [ this.identAst() ]; }continue
case 36:switch(this.l()){
case'.':this.c(37);continue
default:this.gr(['@']);continue
}
case 37:if(this.miA(36,$.category)){ $.name.path.push( this.identAst() ); }continue
default:
this.attachLocation( $.name )
return this.exit_()
}
}
simplePath($,$next){
$.ref??={}
this.rule_(39,$next)
for(;;)switch(this.s){
case 39:if(this.mi(40,$.category)){ $.ref.path = [ this.identAst() ]; }continue
case 40:switch(this.l()){
case'.':this.c(41);continue
default:this.gr([]);continue
}
case 41:if(this.miA(40,$.category)){ $.ref.path.push( this.identAst() ); }continue
default:
this.attachLocation( $.ref )
return this.exit_()
}
}
serviceDef($,$next){
let name;let _
this.rule_(43,$next)
for(;;)switch(this.s){
case 43:if(this.mk(44,'service')){this.vocabularyRestriction()}continue;
case 44:if(this.namePath(_={category:'Service'},45)){name=_.name; this.addDef( $.art, $.outer, 'artifacts', 'service', name );
this.docComment( $.art ); }continue
case 45:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},45);continue
default:this.s=46;continue
}
case 46:switch(this.l()){
case'{':this.artifactsBlock({art:$.art,start:undefined},0);continue
default:this.gr([';']);continue
}
default:
this.attachLocation( $.art )
return this.exit_()
}
}
contextDef($,$next){
let name;let _
this.rule_(48,$next)
for(;;)switch(this.s){
case 48:if(this.mk(49,'context')){this.vocabularyRestriction()}continue;
case 49:if(this.namePath(_={category:'Context'},50)){name=_.name; this.addDef( $.art, $.outer, 'artifacts', 'context', name );
this.docComment( $.art ); }continue
case 50:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},50);continue
default:this.s=51;continue
}
case 51:switch(this.l()){
case'{':this.artifactsBlock({art:$.art,start:undefined},0);continue
default:this.gr([';']);continue
}
default:
this.attachLocation( $.art )
return this.exit_()
}
}
annotationDef($,$next){
let name;let _
this.rule_(53,$next)
for(;;)switch(this.s){
case 53:this.mk(54,'annotation');continue
case 54:if(this.namePath(_={category:'AnnoDef'},55)){name=_.name; this.addDef( $.art, $.outer, ($.outer.kind === 'source' ? 'vocabularies' : 'artifacts'), 'annotation', name );
this.docComment( $.art ); }continue
case 55:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},55);continue
default:this.s=56;continue
}
case 56:this.typeOrIncludesSpec({art:$.art},0);continue
default:
this.attachLocation( $.art )
return this.exit_()
}
}
typeDef($,$next){
let name;let _
this.rule_(58,$next)
for(;;)switch(this.s){
case 58:this.mk(59,'type');continue
case 59:if(this.namePath(_={category:'Type'},60)){name=_.name; this.addDef( $.art, $.outer, 'artifacts', 'type', name );
this.docComment( $.art ); }continue
case 60:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},60);continue
default:this.s=61;continue
}
case 61:this.typeOrIncludesSpec({art:$.art},0);continue
default:
this.attachLocation( $.art )
return this.exit_()
}
}
aspectDef($,$next){
let name;let incl;let _
this.rule_(63,$next)
for(;;)switch(this.s){
case 63:switch(this.lk()){
case'aspect':this.ck(65);continue
case'abstract':if(this.ck(64)){ this.warning( 'syntax-deprecated-abstract', this.combineLocation( this.lb(), this.la() ) ); }continue
default:this.e();continue
}
case 64:this.mk(65,'entity');continue
case 65:if(this.namePath(_={category:'Type'},66)){name=_.name; this.addDef( $.art, $.outer, 'artifacts', 'aspect', name );
this.docComment( $.art ); }continue
case 66:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},66);continue
default:this.s=67;continue
}
case 67:switch(this.l()){
case'{':this.elementsBlock({art:$.art},71);continue
case':':this.c(68);continue
default:this.gr([';']);continue
}
case 68:switch(this.l()){
case'Id':if(this.simplePath(_={category:'artref'},69)){incl=_.ref; $.art.includes ??= []; $.art.includes.push( incl ); }continue
default:this.s=70;continue
}
case 69:switch(this.l()){
case',':this.c(68);continue
case'{':this.s=70;continue
default:this.gr([';']);continue
}
case 70:this.elementsBlock({art:$.art},71);continue
case 71:switch(this.lk()){
case'actions':this.actionsBlock({art:$.art},0);continue
default:this.gr([';']);continue
}
default:
this.attachLocation( $.art )
return this.exit_()
}
}
entityDef($,$next){
let name;let incl;let query;let _
this.rule_(73,$next)
for(;;)switch(this.s){
case 73:this.mk(74,'entity');continue
case 74:if(this.namePath(_={category:'Entity'},75)){name=_.name; this.addDef( $.art, $.outer, 'artifacts', 'entity', name );
this.docComment( $.art ); }continue
case 75:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},75);continue
default:this.s=76;continue
}
case 76:switch(this.l()){
case'(':this.paramsList({art:$.art},77);continue
default:this.s=77;continue
}
case 77:switch(this.lk()){
case':':if(this.c(78)){ $.art.includes ??= []; }continue
case'{':this.s=81;continue
case'as':this.ck(82);continue
default:this.e();continue
}
case 78:switch(this.lk()){
case'Id':this.s=79;continue
default:this.ei();continue
}
case 79:switch(this.l()){
case'Id':if(this.simplePath(_={category:'artref'},80)){incl=_.ref; $.art.includes.push( incl ); }continue
default:this.s=81;continue
}
case 80:switch(this.l()){
case',':this.c(79);continue
case'{':this.s=81;continue
default:this.e();continue
}
case 81:this.elementsBlock({art:$.art},87);continue
case 82:switch(this.lk()){
case'(':case'select':if(this.queryExpression(_={},87)){query=_.expr; $.art.query = query; $.art.$syntax = 'entity'; }continue
case'projection':this.s=83;{this.afterBrace(0,'sloppy')}continue;
default:this.e();continue
}
case 83:if(this.projectionSpec(_={},84)){query=_.query; $.art.query = query; $.art.$syntax = 'projection'; }continue
case 84:switch(this.lk()){
case'group':case'where':case'having':this.whereGroupByHaving({query},85);continue
default:this.s=85;continue
}
case 85:switch(this.lk()){
case'limit':case'order':this.orderByLimitOffset({query},86);continue
default:this.s=86;continue
}
case 86:this.s=87;{this.afterBrace(0,'normal'); ; }continue
case 87:switch(this.lk()){
case'actions':this.actionsBlock({art:$.art},0);continue
default:this.gr([';']);continue
}
default:
this.attachLocation( $.art )
return this.exit_()
}
}
viewDef($,$next){
let name;let query;let _
this.rule_(89,$next)
for(;;)switch(this.s){
case 89:this.mk(90,'view');continue
case 90:if(this.namePath(_={category:'Entity'},91)){name=_.name; this.addDef( $.art, $.outer, 'artifacts', 'entity', name );
this.docComment( $.art ); }continue
case 91:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},91);continue
default:this.s=92;continue
}
case 92:switch(this.lk()){
case'(':this.paramsList({art:$.art},98);continue
case'with':this.ck(93);continue
default:this.s=98;continue
}
case 93:if(this.mk(94,'parameters')){ $.art.params = this.createDict(); }continue
case 94:this.paramDef({outer:$.art},95);continue
case 95:switch(this.l()){
case',':this.c(96);continue
default:this.s=97;continue
}
case 96:this.paramDef({outer:$.art},95);continue
case 97:this.s=98;{ this.finalizeDictOrArray( $.art.params ); }continue
case 98:this.mk(99,'as');continue
case 99:if(this.queryExpression(_={},0)){query=_.expr; $.art.query = query; $.art.$syntax = 'view'; }continue
default:
this.attachLocation( $.art )
return this.exit_()
}
}
eventDef($,$next){
let name;let incl;let query;let _
this.rule_(101,$next)
for(;;)switch(this.s){
case 101:this.mk(102,'event');continue
case 102:if(this.namePath(_={category:'Event'},103)){name=_.name; this.addDef( $.art, $.outer, 'artifacts', 'event', name );
this.docComment( $.art ); }continue
case 103:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},103);continue
default:this.s=104;continue
}
case 104:switch(this.l()){
case'{':this.elementsBlock({art:$.art},0);continue
case':':this.c(105);continue
default:this.e();continue
}
case 105:switch(this.lk()){
case'{':this.elementsBlock({art:$.art},0);continue
case'Id':if(this.simplePath(_={category:'artref'},106)){incl=_.ref; $.art.type = incl; }continue
case'projection':if(this.lP()&&this.projectionSpec(_={},0)){query=_.query; $.art.query = query; $.art.$syntax = 'projection'; }continue
default:this.ei();continue
}
case 106:switch(this.l()){
case',':case'{':this.s=107;{ $.art.includes = [ $.art.type ]; delete $.art.type; }continue
default:this.s=111;{ this.docComment( $.art ); }continue
}
case 107:switch(this.l()){
case',':this.c(108);continue
default:this.s=110;continue
}
case 108:switch(this.l()){
case'Id':if(this.simplePath(_={category:'artref'},109)){incl=_.ref; $.art.includes.push( incl ); }continue
default:this.s=110;continue
}
case 109:switch(this.l()){
case',':this.c(108);continue
case'{':this.s=110;continue
default:this.e();continue
}
case 110:this.elementsBlock({art:$.art},0);continue
case 111:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},111);continue
default:this.gr([';']);continue
}
default:
this.attachLocation( $.art )
return this.exit_()
}
}
actionMainDef($,$next){
let name;let _
this.rule_(113,$next)
for(;;)switch(this.s){
case 113:this.mk(114,'action');continue
case 114:if(this.namePath(_={category:'Action'},115)){name=_.name; this.addDef( $.art, $.outer, 'artifacts', 'action', name );
this.docComment( $.art ); }continue
case 115:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},115);continue
default:this.s=116;continue
}
case 116:this.paramsList({art:$.art},117);continue
case 117:switch(this.lk()){
case'returns':this.returnsSpec({outer:$.art},0);continue
default:this.gr([';']);continue
}
default:
this.attachLocation( $.art )
return this.exit_()
}
}
functionMainDef($,$next){
let name;let _
this.rule_(119,$next)
for(;;)switch(this.s){
case 119:this.mk(120,'function');continue
case 120:if(this.namePath(_={category:'Action'},121)){name=_.name; this.addDef( $.art, $.outer, 'artifacts', 'function', name );
this.docComment( $.art ); }continue
case 121:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},121);continue
default:this.s=122;continue
}
case 122:this.paramsList({art:$.art},123);continue
case 123:this.returnsSpec({outer:$.art},0);continue
default:
this.attachLocation( $.art )
return this.exit_()
}
}
actionsBlock($,$next){
this.rule_(125,$next)
for(;;)switch(this.s){
case 125:if(this.mk(126,'actions')){ $.art.actions = this.createDict(); }continue
case 126:this.m(127,'{');continue
case 127:switch(this.l()){
case'Id':case'@':this.boundActionFunctionDef({outer:$.art},128);continue
default:this.s=129;continue
}
case 128:switch(this.l()){
case';':this.c(127);continue
case'}':this.s=129;continue
case'Id':case'@':if(this.ec('afterBrace')&&this.g(127)){ this.noAssignmentInSameLine(); }continue
default:this.e();continue
}
case 129:if(this.m(0,'}')){this.afterBrace(); this.finalizeDictOrArray( $.art.actions ); }continue
default:return this.exit_()
}
}
boundActionFunctionDef($,$next){
let art=new XsnArtifact()
this.rule_(131,$next)
{ this.docComment( art ); }
for(;;)switch(this.s){
case 131:switch(this.l()){
case'@':this.annoAssignStd({art},131);continue
default:this.s=132;continue
}
case 132:switch(this.lk()){
case'action':this.ck(133);continue
case'function':this.ck(137);continue
default:this.e();continue
}
case 133:if(this.mi(134,'BoundAction')){ this.addDef( art, $.outer, 'actions', 'action', this.identAst() );
this.docComment( art ); }continue
case 134:switch(this.l()){
case'@':this.annoAssignMid({art},134);continue
default:this.s=135;continue
}
case 135:this.paramsList({art},136);continue
case 136:switch(this.lk()){
case'returns':this.returnsSpec({outer:art},0);continue
default:this.gr([';']);continue
}
case 137:if(this.mi(138,'BoundAction')){ this.addDef( art, $.outer, 'actions', 'function', this.identAst() );
this.docComment( art ); }continue
case 138:switch(this.l()){
case'@':this.annoAssignMid({art},138);continue
default:this.s=139;continue
}
case 139:this.paramsList({art},140);continue
case 140:this.returnsSpec({outer:art},0);continue
default:
this.attachLocation( art )
return this.exit_()
}
}
paramsList($,$next){
this.rule_(142,$next)
for(;;)switch(this.s){
case 142:if(this.m(143,'(')){ $.art.params = this.createDict(); }continue
case 143:switch(this.l()){
case'Id':case'@':this.paramDef({outer:$.art},144);continue
default:this.s=145;continue
}
case 144:switch(this.l()){
case',':this.c(143);continue
case')':this.s=145;continue
default:this.e();continue
}
case 145:if(this.m(0,')')){ this.finalizeDictOrArray( $.art.params ); }continue
default:return this.exit_()
}
}
paramDef($,$next){
let art=new XsnArtifact()
this.rule_(147,$next)
{ this.docComment( art ); }
for(;;)switch(this.s){
case 147:switch(this.l()){
case'@':this.annoAssignStd({art},147);continue
default:this.s=148;continue
}
case 148:if(this.miA(149,'Param')){ this.addDef( art, $.outer, 'params', 'param', this.identAst() );
this.docComment( art ); }continue
case 149:switch(this.l()){
case'@':this.annoAssignMid({art},149);continue
default:this.s=150;continue
}
case 150:switch(this.l()){
case'{':this.elementsBlock({art},151);continue
case':':this.c(152);continue
default:this.e();continue
}
case 151:switch(this.lk()){
case'not':case'null':this.nullability({art},0);continue
default:this.gr([',']);continue
}
case 152:this.typeExpression({art},0);continue
default:
this.attachLocation( art )
return this.exit_()
}
}
returnsSpec($,$next){
let art=new XsnArtifact()
let ret
this.rule_(154,$next)
for(;;)switch(this.s){
case 154:if(this.mk(155,'returns')){ret=this.lb();this.elementRestriction(0,'default'); art.kind = 'param'; $.outer.returns = art;
this.docComment( art ); }continue
case 155:switch(this.l()){
case'@':this.annoAssignStd({art},155);continue
default:this.s=156;continue
}
case 156:this.typeExpression({art},0);continue
default:
this.attachLocation( art ); if (ret) art.location.tokenIndex = ret.location.tokenIndex
return this.exit_()
}
}
elementsBlock($,$next){
this.rule_(158,$next)
for(;;)switch(this.s){
case 158:if(this.m(159,'{')){ $.art.elements = this.createDict(); }continue
case 159:switch(this.l()){
case'Id':case'@':this.elementDef({outer:$.art,art:undefined},160);continue
default:this.s=161;continue
}
case 160:switch(this.l()){
case';':this.c(159);continue
case'}':this.s=161;continue
case'Id':case'@':if(this.ec('afterBrace')&&this.g(159)){ this.noAssignmentInSameLine(); }continue
default:this.e();continue
}
case 161:if(this.m(0,'}')){this.afterBrace(); this.finalizeDictOrArray( $.art.elements ); }continue
default:return this.exit_()
}
}
elementDef($,$next){
let expr;let _
this.rule_(163,$next)
{ $.art ??= new XsnArtifact();
this.docComment( $.art ); }
for(;;)switch(this.s){
case 163:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},163);continue
default:this.s=164;continue
}
case 164:switch(this.lk()){
case'virtual':if(this.ckP(165,['Id','key'])){ $.art.virtual = this.valueWithLocation( true ); }continue
default:this.s=165;continue
}
case 165:switch(this.lk()){
case'key':if(this.ck(166)){ $.art.key = this.valueWithLocation( true ); }continue
default:this.s=166;continue
}
case 166:switch(this.lk()){
case'masked':if(this.ckP(167,['Id'])){ $.art.masked = this.valueWithLocation( true );
this.message( 'syntax-unsupported-masked', this.lb(), { keyword: 'masked' } ); }continue
default:this.s=167;continue
}
case 167:switch(this.lk()){
case'element':if(this.ckP(168,['Id'])){ $.art.$syntax = 'element'; }continue
default:this.s=168;continue
}
case 168:if(this.mi(169,'Element')){this.elementRestriction(0,'elem'); this.addDef( $.art, $.outer, 'elements', 'element', this.identAst() );
this.docComment( $.art ); }continue
case 169:switch(this.l()){
case'@':this.annoAssignMid({art:$.art},169);continue
default:this.s=170;continue
}
case 170:switch(this.l()){
case'{':this.elementsBlock({art:$.art},171);continue
case':':this.c(172);continue
default:this.s=173;continue
}
case 171:switch(this.lk()){
case'not':case'null':this.nullability({art:$.art},173);continue
default:this.s=173;continue
}
case 172:this.typeExpression({art:$.art},173);continue
case 173:switch(this.l()){
case'=':this.gc(0,'elementRestriction','calc')&&this.c(174);continue
default:this.gr([';']);continue
}
case 174:if(this.expression(_={},175)){expr=_.expr; $.art.value = expr; }continue
case 175:switch(this.lk()){
case'stored':if(this.ck(176)){ $.art.value.stored = this.valueWithLocation( true ); }continue
default:this.s=176;continue
}
case 176:this.s=177;{ if (!this.elementRestriction( true, 'anno' )) this.docComment( $.art ); }continue
case 177:switch(this.l()){
case'@':this.gc(0,'elementRestriction','anno')&&this.annoAssignStd({art:$.art},177);continue
default:this.gr([';']);continue
}
default:
this.attachLocation( $.art )
return this.exit_()
}
}
enumSymbolsBlock($,$next){
this.rule_(179,$next)
for(;;)switch(this.s){
case 179:if(this.mk(180,'enum')){ $.art.enum = this.createDict(); }continue
case 180:this.m(181,'{');continue
case 181:switch(this.l()){
case'Id':case'@':this.enumSymbolDef({outer:$.art},182);continue
default:this.s=183;continue
}
case 182:switch(this.l()){
case';':this.c(181);continue
case'}':this.s=183;continue
default:this.e();continue
}
case 183:if(this.m(0,'}')){this.afterBrace(); this.finalizeDictOrArray( $.art.enum ); }continue
default:return this.exit_()
}
}
enumSymbolDef($,$next){
let art=new XsnArtifact()
let sign;let value;let _
this.rule_(185,$next)
{ this.docComment( art ); }
for(;;)switch(this.s){
case 185:switch(this.l()){
case'@':this.annoAssignStd({art},185);continue
default:this.s=186;continue
}
case 186:if(this.mi(187,'Enum')){ this.addDef( art, $.outer, 'enum', 'enum', this.identAst() );
this.docComment( art ); }continue
case 187:switch(this.l()){
case'@':this.annoAssignStd({art},187);continue
default:this.s=188;continue
}
case 188:switch(this.l()){
case'=':this.c(189);continue
default:this.gr([';','}']);continue
}
case 189:switch(this.l()){
case'String':if(this.c(191)){ art.value = this.quotedLiteral(); }continue
case'Number':if(this.c(191)){ art.value = this.numberLiteral(); }continue
case'+':case'-':if(this.c(190))sign=this.lb();continue
case'Id':case'#':case'QuotedLiteral':if(this.literalValue(_={},191)){value=_.expr; art.value = value; }continue
default:this.e();continue
}
case 190:if(this.m(191,'Number')){ art.value = this.numberLiteral( sign ); }continue
case 191:this.s=192;{ this.docComment( art ); }continue
case 192:switch(this.l()){
case'@':this.annoAssignStd({art},192);continue
default:this.gr([';','}']);continue
}
default:
this.attachLocation( art )
return this.exit_()
}
}
foreignKeysBlock($,$next){
this.rule_(194,$next)
for(;;)switch(this.s){
case 194:if(this.m(195,'{')){ $.art.foreignKeys = this.createDict(); }continue
case 195:switch(this.l()){
case'Id':case'@':this.foreignKeyDef({outer:$.art},196);continue
default:this.s=197;continue
}
case 196:switch(this.l()){
case',':this.c(195);continue
case'}':this.s=197;continue
default:this.e();continue
}
case 197:if(this.m(0,'}')){ this.finalizeDictOrArray( $.art.foreignKeys ); }continue
default:return this.exit_()
}
}
foreignKeyDef($,$next){
let art=new XsnArtifact();let name
let ref;let _
this.rule_(199,$next)
{ this.docComment( art ); }
for(;;)switch(this.s){
case 199:switch(this.l()){
case'@':this.annoAssignStd({art},199);continue
default:this.s=200;continue
}
case 200:if(this.simplePath(_={category:'ref'},201)){ref=_.ref; art.targetElement = ref; }continue
case 201:switch(this.lk()){
case'as':this.ck(202);continue
default:if(this.gr([',','}'])){ this.classifyImplicitName( 'KeyImplicit', ref ); name = ref.path; }continue
}
case 202:if(this.mi(0,'Key')){name=this.lb(); name = this.identAst(); }continue
case 0:{ this.addDef( art, $.outer, 'foreignKeys', 'key', name ); }
default:
this.attachLocation(art)
return this.exit_()
}
}
mixinElementDef($,$next){
let art=new XsnArtifact()
let assoc;let card;let target;let expr;let _
this.rule_(204,$next)
for(;;)switch(this.s){
case 204:if(this.mi(205,'Mixin')){ this.addDef( art, $.outer, 'mixin', 'mixin', this.identAst() ); }continue
case 205:this.m(206,':');continue
case 206:switch(this.lk()){
case'association':if(this.ck(207))assoc=this.lb();continue
case'composition':if(this.ck(209))assoc=this.lb();continue
default:this.e();continue
}
case 207:switch(this.l()){
case'[':this.cardinality({art},208);continue
default:this.s=208;continue
}
case 208:this.mk(211,'to');continue
case 209:switch(this.l()){
case'[':this.cardinality({art},210);continue
default:this.s=210;continue
}
case 210:this.mk(211,'of');continue
case 211:switch(this.lk()){
case'one':case'many':if(this.lP(['Id'])&&this.gc(212,'noRepeatedCardinality')&&this.ck(212))card=this.lb();continue
default:this.s=212;continue
}
case 212:if(this.simplePath(_={category:'artref'},213)){target=_.ref; this.setAssocAndComposition( art, assoc, card, target ); }continue
case 213:this.mk(214,'on');continue
case 214:if(this.condition(_={},0)){expr=_.expr; art.on = expr; }continue
default:
this.attachLocation(art)
return this.exit_()
}
}
annotateArtifact($,$next){
let name;let elemName;let keyword;let _
this.rule_(216,$next)
for(;;)switch(this.s){
case 216:if(this.namePath(_={category:'Ext'},217))name=_.name;continue
case 217:switch(this.lk()){
case':':this.c(218);continue
case'with':if(this.ck(223))keyword=this.lb();continue
default:this.s=223;continue
}
case 218:if(this.namePath(_={category:'ExtElement'},219)){elemName=_.name; this.addExtension( $.art, $.outer, 'annotate', name, elemName.path ); }continue
case 219:switch(this.lk()){
case'with':if(this.ck(220))keyword=this.lb();continue
default:this.s=220;continue
}
case 220:this.s=221;{ this.docComment( $.art ); }continue
case 221:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},221);continue
default:this.s=222;continue
}
case 222:switch(this.l()){
case'{':this.annotateElementsBlock({art:$.art},0);continue
default:this.gr([';']);continue
}
case 223:this.s=224;{ this.addExtension( $.art, $.outer, 'annotate', name );
this.docComment( $.art ); }continue
case 224:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},224);continue
default:this.s=225;continue
}
case 225:switch(this.l()){
case'(':this.annotateParamsBlock({art:$.art},226);continue
default:this.s=226;continue
}
case 226:switch(this.lk()){
case'returns':this.annotateReturns({outer:$.art},0);continue
case'{':this.annotateElementsBlock({art:$.art},227);continue
default:this.s=227;continue
}
case 227:switch(this.lk()){
case'actions':this.annotateActionsBlock({art:$.art},0);continue
default:this.gr([';']);continue
}
case 0:{ this.checkWith( keyword ); }
default:
this.attachLocation( $.art )
return this.exit_()
}
}
extendArtifact($,$next){
let name;let elemName;let keyword;let elements;let incl;let _
this.rule_(229,$next)
for(;;)switch(this.s){
case 229:if(this.namePath(_={category:'Ext'},230))name=_.name;continue
case 230:switch(this.lk()){
case':':this.c(231);continue
case'with':if(this.ck(240)){keyword=this.lb(); this.addExtension( $.art, $.outer, 'extend', name );
this.docComment( $.art ); }continue
default:this.s=237;{ this.addExtension( $.art, $.outer, 'extend', name );
this.docComment( $.art ); }continue
}
case 231:if(this.namePath(_={category:'ExtElement'},232)){elemName=_.name; this.addExtension( $.art, $.outer, 'extend', name, elemName.path ); }continue
case 232:switch(this.lk()){
case'with':if(this.ck(233))keyword=this.lb();continue
default:this.s=233;continue
}
case 233:this.s=234;{ this.docComment( $.art ); }continue
case 234:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},234);continue
default:this.s=235;continue
}
case 235:switch(this.lk()){
case'elements':if(this.ck(236))elements=this.lb();continue
case'{':this.s=236;continue
case'enum':this.enumSymbolsBlock({art:$.art},0);continue
case'(':this.typeNamedArgsList({art:$.art},0);continue
default:this.gr([';']);continue
}
case 236:this.extendElementsBlock({art:$.art,start:elements},0);continue
case 237:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},237);continue
default:this.s=238;continue
}
case 238:switch(this.l()){
case'{':this.extendElementsBlock({art:$.art,start:undefined},239);continue
default:this.gr([';']);continue
}
case 239:switch(this.lk()){
case'actions':this.actionsBlock({art:$.art},0);continue
default:this.gr([';']);continue
}
case 240:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},240);continue
default:this.s=241;continue
}
case 241:switch(this.lk()){
case'Id':if(this.simplePath(_={category:'artref'},242)){incl=_.ref; $.art.includes = [ incl ]; }continue
case'elements':if(this.ckP(246,['{']))elements=this.lb();continue
case'{':this.s=246;continue
case'actions':this.lP()&&this.actionsBlock({art:$.art},0);continue
case'enum':this.lP()&&this.enumSymbolsBlock({art:$.art},0);continue
case'(':this.typeNamedArgsList({art:$.art},0);continue
case'columns':this.ckP(248,['{']);continue
case'definitions':this.ckP(249,['{']);continue
default:this.gi(0,[';']);continue
}
case 242:switch(this.l()){
case',':this.c(243);continue
default:this.s=244;continue
}
case 243:if(this.simplePath(_={category:'artref'},242)){incl=_.ref; $.art.includes.push( incl ); }continue
case 244:switch(this.l()){
case'{':this.extendElementsBlock({art:$.art,start:undefined},245);continue
default:this.s=245;continue
}
case 245:switch(this.lk()){
case'actions':this.actionsBlock({art:$.art},0);continue
default:this.gr([';']);continue
}
case 246:this.extendElementsBlock({art:$.art,start:elements},247);continue
case 247:switch(this.lk()){
case'actions':this.actionsBlock({art:$.art},0);continue
default:this.gr([';']);continue
}
case 248:this.selectItemsList({query:$.art,start:this.lb()},0);continue
case 249:this.artifactsBlock({art:$.art,start:this.lb()},0);continue
case 0:{ this.checkWith( keyword ); }
default:
this.attachLocation( $.art )
return this.exit_()
}
}
extendService($,$next){
let name;let keyword;let _
this.rule_(251,$next)
for(;;)switch(this.s){
case 251:if(this.mk(252,'service')){ $.art.expectedKind = this.valueWithLocation(); }continue
case 252:if(this.namePath(_={category:'ExtService'},253)){name=_.name; $.art.name = name; $.outer.extensions.push( $.art ); }continue
case 253:switch(this.lk()){
case'with':if(this.ck(254))keyword=this.lb();continue
default:this.s=254;continue
}
case 254:this.s=255;{ this.docComment( $.art ); }continue
case 255:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},255);continue
default:this.s=256;continue
}
case 256:switch(this.l()){
case'{':this.artifactsBlock({art:$.art,start:undefined},0);continue
default:this.gr([';']);continue
}
default:
this.checkWith( keyword ); this.attachLocation( $.art )
return this.exit_()
}
}
extendContext($,$next){
let name;let keyword;let _
this.rule_(258,$next)
for(;;)switch(this.s){
case 258:if(this.mk(259,'context')){ $.art.expectedKind = this.valueWithLocation(); }continue
case 259:if(this.namePath(_={category:'ExtContext'},260)){name=_.name; $.art.name = name; $.outer.extensions.push( $.art ); }continue
case 260:switch(this.lk()){
case'with':if(this.ck(261))keyword=this.lb();continue
default:this.s=261;continue
}
case 261:this.s=262;{ this.docComment( $.art ); }continue
case 262:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},262);continue
default:this.s=263;continue
}
case 263:switch(this.l()){
case'{':this.artifactsBlock({art:$.art,start:undefined},0);continue
default:this.gr([';']);continue
}
default:
this.checkWith( keyword ); this.attachLocation( $.art )
return this.exit_()
}
}
extendType($,$next){
let name;let keyword;let incl;let elements;let _
this.rule_(265,$next)
for(;;)switch(this.s){
case 265:if(this.mk(266,'type')){ $.art.expectedKind = this.valueWithLocation(); }continue
case 266:if(this.namePath(_={category:'Ext'},267)){name=_.name; $.art.name = name; $.outer.extensions.push( $.art ); }continue
case 267:switch(this.lk()){
case'with':if(this.ck(270)){keyword=this.lb(); this.docComment( $.art ); }continue
default:this.s=268;{ this.docComment( $.art ); }continue
}
case 268:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},268);continue
default:this.s=269;continue
}
case 269:switch(this.l()){
case'{':this.extendElementsBlock({art:$.art,start:undefined},0);continue
default:this.gr([';']);continue
}
case 270:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},270);continue
default:this.s=271;continue
}
case 271:switch(this.lk()){
case'Id':if(this.simplePath(_={category:'artref'},272)){incl=_.ref; $.art.includes = [ incl ]; }continue
case'elements':if(this.ckP(275,['{']))elements=this.lb();continue
case'{':this.s=275;continue
case'enum':this.lP()&&this.enumSymbolsBlock({art:$.art},0);continue
case'(':this.typeNamedArgsList({art:$.art},0);continue
default:this.gi(0,[';']);continue
}
case 272:switch(this.l()){
case',':this.c(273);continue
default:this.s=274;continue
}
case 273:if(this.simplePath(_={category:'artref'},272)){incl=_.ref; $.art.includes.push( incl ); }continue
case 274:switch(this.l()){
case'{':this.extendElementsBlock({art:$.art,start:undefined},0);continue
default:this.gr([';']);continue
}
case 275:this.extendElementsBlock({art:$.art,start:elements},0);continue
default:
this.checkWith( keyword ); this.attachLocation( $.art )
return this.exit_()
}
}
extendEntityOrAspect($,$next){
let name;let keyword;let incl;let _
this.rule_(277,$next)
for(;;)switch(this.s){
case 277:switch(this.lk()){
case'aspect':case'entity':if(this.ck(278)){ $.art.expectedKind = this.valueWithLocation(); }continue
default:this.e();continue
}
case 278:if(this.namePath(_={category:'Ext'},279)){name=_.name; $.art.name = name; $.outer.extensions.push( $.art ); }continue
case 279:switch(this.lk()){
case'with':if(this.ck(281)){keyword=this.lb(); this.docComment( $.art ); }continue
default:this.s=280;{ this.docComment( $.art ); }continue
}
case 280:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},280);continue
default:this.s=285;continue
}
case 281:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},281);continue
default:this.s=282;continue
}
case 282:switch(this.lk()){
case'Id':if(this.simplePath(_={category:'artref'},283)){incl=_.ref; $.art.includes = [ incl ]; }continue
case'actions':this.gP(285);continue
default:this.gi(285);continue
}
case 283:switch(this.l()){
case',':this.c(284);continue
default:this.s=285;continue
}
case 284:if(this.simplePath(_={category:'artref'},283)){incl=_.ref; $.art.includes.push( incl ); }continue
case 285:switch(this.l()){
case'{':this.extendElementsBlock({art:$.art,start:undefined},286);continue
default:this.s=286;continue
}
case 286:switch(this.lk()){
case'actions':this.actionsBlock({art:$.art},0);continue
default:this.gr([';']);continue
}
default:
this.checkWith( keyword ); this.attachLocation( $.art )
return this.exit_()
}
}
extendProjection($,$next){
let name;let keyword;let _
this.rule_(288,$next)
for(;;)switch(this.s){
case 288:if(this.mk(289,'projection')){ $.art.expectedKind = this.valueWithLocation(); }continue
case 289:if(this.namePath(_={category:'Ext'},290)){name=_.name; $.art.name = name; $.outer.extensions.push( $.art ); }continue
case 290:switch(this.lk()){
case'with':if(this.ck(291))keyword=this.lb();continue
default:this.s=291;continue
}
case 291:this.s=292;{ this.docComment( $.art ); }continue
case 292:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},292);continue
default:this.s=293;continue
}
case 293:switch(this.l()){
case'{':this.selectItemsList({query:$.art,start:undefined},294);continue
default:this.s=294;continue
}
case 294:switch(this.lk()){
case'actions':this.actionsBlock({art:$.art},0);continue
default:this.gr([';']);continue
}
default:
this.checkWith( keyword ); this.attachLocation( $.art )
return this.exit_()
}
}
annotateActionsBlock($,$next){
this.rule_(296,$next)
for(;;)switch(this.s){
case 296:if(this.mk(297,'actions')){ $.art.actions = this.createDict(); }continue
case 297:this.m(298,'{');continue
case 298:switch(this.l()){
case'Id':case'@':this.annotateBoundAction({outer:$.art},299);continue
default:this.s=300;continue
}
case 299:switch(this.l()){
case';':this.c(298);continue
case'}':this.s=300;continue
case'Id':case'@':if(this.ec('afterBrace')&&this.g(298)){ this.noAssignmentInSameLine(); }continue
default:this.e();continue
}
case 300:if(this.m(0,'}')){this.afterBrace(); this.finalizeExtensionsDict( $.art.actions ); }continue
default:return this.exit_()
}
}
annotateBoundAction($,$next){
let art=new XsnArtifact()
this.rule_(302,$next)
{ this.docComment( art ); }
for(;;)switch(this.s){
case 302:switch(this.l()){
case'@':this.annoAssignStd({art},302);continue
default:this.s=303;continue
}
case 303:if(this.mi(304,'ExtBoundAction')){ this.addDef( art, $.outer, 'actions', 'annotate', this.identAst() );
this.docComment( art ); }continue
case 304:switch(this.l()){
case'@':this.annoAssignStd({art},304);continue
default:this.s=305;continue
}
case 305:switch(this.l()){
case'(':this.annotateParamsBlock({art},306);continue
default:this.s=306;continue
}
case 306:switch(this.lk()){
case'returns':this.lP()&&this.annotateReturns({outer:art},0);continue
default:this.gr([';']);continue
}
default:
this.attachLocation( art )
return this.exit_()
}
}
annotateParamsBlock($,$next){
this.rule_(308,$next)
for(;;)switch(this.s){
case 308:if(this.m(309,'(')){ $.art.params = this.createDict(); }continue
case 309:switch(this.l()){
case'Id':case'@':this.annotateParam({outer:$.art},310);continue
default:this.s=311;continue
}
case 310:switch(this.l()){
case',':this.c(309);continue
case')':this.s=311;continue
default:this.e();continue
}
case 311:if(this.m(0,')')){ this.finalizeExtensionsDict( $.art.params ); }continue
default:return this.exit_()
}
}
annotateParam($,$next){
let art=new XsnArtifact()
this.rule_(313,$next)
{ this.docComment( art ); }
for(;;)switch(this.s){
case 313:switch(this.l()){
case'@':this.annoAssignStd({art},313);continue
default:this.s=314;continue
}
case 314:if(this.mi(315,'ExtParam')){ this.addDef( art, $.outer, 'params', 'annotate', this.identAst() );
this.docComment( art ); }continue
case 315:switch(this.l()){
case'@':this.annoAssignStd({art},315);continue
default:this.gr([')',',']);continue
}
default:
this.attachLocation( art )
return this.exit_()
}
}
annotateReturns($,$next){
let art=new XsnArtifact()
let ret
this.rule_(317,$next)
for(;;)switch(this.s){
case 317:if(this.mk(318,'returns')){ret=this.lb(); $.outer.returns = art; art.kind = 'annotate';
this.docComment( art ); }continue
case 318:switch(this.l()){
case'@':this.annoAssignStd({art},318);continue
default:this.s=319;continue
}
case 319:switch(this.l()){
case'{':this.annotateElementsBlock({art},0);continue
default:this.gr([';']);continue
}
default:
this.attachLocation( art ); if (ret) art.location.tokenIndex = ret.location.tokenIndex
return this.exit_()
}
}
annotateElementsBlock($,$next){
this.rule_(321,$next)
for(;;)switch(this.s){
case 321:if(this.m(322,'{')){ $.art.elements = this.createDict(); }continue
case 322:switch(this.l()){
case'Id':case'@':this.annotateElement({outer:$.art},323);continue
default:this.s=324;continue
}
case 323:switch(this.l()){
case';':this.c(322);continue
case'}':this.s=324;continue
case'Id':case'@':if(this.ec('afterBrace')&&this.g(322)){ this.noAssignmentInSameLine(); }continue
default:this.e();continue
}
case 324:if(this.m(0,'}')){this.afterBrace(); this.finalizeExtensionsDict( $.art.elements ); }continue
default:return this.exit_()
}
}
annotateElement($,$next){
let art=new XsnArtifact()
this.rule_(326,$next)
{ this.docComment( art ); }
for(;;)switch(this.s){
case 326:switch(this.l()){
case'@':this.annoAssignStd({art},326);continue
default:this.s=327;continue
}
case 327:if(this.mi(328,'ExtElement')){ this.addDef( art, $.outer, 'elements', 'annotate', this.identAst() );
this.docComment( art ); }continue
case 328:switch(this.l()){
case'@':this.annoAssignStd({art},328);continue
default:this.s=329;continue
}
case 329:switch(this.l()){
case'{':this.annotateElementsBlock({art},0);continue
default:this.gr([';']);continue
}
default:
this.attachLocation( art )
return this.exit_()
}
}
extendElementsBlock($,$next){
this.rule_(331,$next)
for(;;)switch(this.s){
case 331:if(this.m(332,'{')){ $.art.elements = this.createDict( $.start ); }continue
case 332:switch(this.l()){
case'Id':case'@':this.elementDefOrExtend({outer:$.art},333);continue
default:this.s=334;continue
}
case 333:switch(this.l()){
case';':this.c(332);continue
case'}':this.s=334;continue
case'Id':case'@':if(this.ec('afterBrace')&&this.g(332)){ this.noAssignmentInSameLine(); }continue
default:this.e();continue
}
case 334:if(this.m(0,'}')){this.afterBrace(); this.finalizeExtensionsDict( $.art.elements ); }continue
default:return this.exit_()
}
}
elementDefOrExtend($,$next){
let art=new XsnArtifact()
let keyword;let elements
this.rule_(336,$next)
{ art.location = this.startLocation();
this.docComment( art ); }
for(;;)switch(this.s){
case 336:switch(this.l()){
case'@':this.annoAssignStd({art},336);continue
default:this.s=337;continue
}
case 337:switch(this.lk()){
case'Id':case'@':case'key':this.elementDef({outer:$.outer,art},0);continue
case'extend':this.ckP(338,['Id']);continue
default:this.ei();continue
}
case 338:switch(this.lk()){
case'element':if(this.ckP(339,['Id'])){ art.expectedKind = this.valueWithLocation(); }continue
default:this.s=339;continue
}
case 339:if(this.mi(340,'ExtElement')){ this.addDef( art, $.outer, 'elements', 'extend', this.identAst() ); }continue
case 340:switch(this.lk()){
case'with':if(this.ck(343)){keyword=this.lb(); this.docComment( art ); }continue
default:this.s=341;{ this.docComment( art ); }continue
}
case 341:switch(this.l()){
case'@':this.annoAssignStd({art},341);continue
default:this.s=342;continue
}
case 342:switch(this.l()){
case'{':this.extendElementsBlock({art,start:undefined},0);continue
default:this.gr([';']);continue
}
case 343:switch(this.l()){
case'@':this.annoAssignStd({art},343);continue
default:this.s=344;continue
}
case 344:switch(this.lk()){
case'elements':if(this.ck(345))elements=this.lb();continue
case'{':this.s=345;continue
case'enum':this.enumSymbolsBlock({art},0);continue
case'(':this.typeNamedArgsList({art},0);continue
default:this.gr([';']);continue
}
case 345:this.extendElementsBlock({art,start:elements},0);continue
default:
this.checkWith( keyword ); this.attachLocation( art )
return this.exit_()
}
}
typeOrIncludesSpec($,$next){
let query;let ref;let _
this.rule_(347,$next)
for(;;)switch(this.s){
case 347:switch(this.l()){
case'{':this.elementsBlock({art:$.art},348);continue
case':':this.c(349);continue
default:this.e();continue
}
case 348:switch(this.lk()){
case'not':case'null':this.nullability({art:$.art},0);continue
default:this.gr([';']);continue
}
case 349:switch(this.lk()){
case'projection':if(this.lP()&&this.projectionSpec(_={},0)){query=_.query; $.art.query = query; $.art.$syntax = 'projection'; }continue
case'{':case'many':case'type':case'array':case'localized':case'association':case'composition':this.lP()&&this.typeExpression({art:$.art},0);continue
case'Id':if(this.simplePath(_={category:'artref'},350)){ref=_.ref; $.art.type = ref; }continue
default:this.ei();continue
}
case 350:switch(this.lk()){
case'(':case':':this.typeRefOptArgs({art:$.art},351,406);continue
case'@':case'not':case'enum':case'null':case'default':this.typeExpression({art:$.art},0,359);continue
case',':case'{':this.s=352;{ $.art.includes = [ $.art.type ]; delete $.art.type; }continue
default:if(this.gr([';'])){ this.docComment( $.art ); }continue
}
case 351:switch(this.lk()){
case'@':case'not':case'enum':case'null':case'default':this.typeExpression({art:$.art},0,359);continue
default:if(this.gr([';'])){ this.docComment( $.art ); }continue
}
case 352:switch(this.l()){
case',':this.c(353);continue
default:this.s=355;continue
}
case 353:switch(this.l()){
case'Id':if(this.simplePath(_={category:'artref'},354)){ref=_.ref; $.art.includes.push( ref ); }continue
default:this.s=355;continue
}
case 354:switch(this.l()){
case',':this.c(353);continue
case'{':this.s=355;continue
default:this.e();continue
}
case 355:this.elementsBlock({art:$.art},356);continue
case 356:switch(this.lk()){
case'not':case'null':this.nullability({art:$.art},0);continue
default:this.gr([';']);continue
}
default:return this.exit_()
}
}
typeExpression($,$next,$startState){
let expr;let assoc;let card;let _
this.rule_($startState??358,$next)
for(;;)switch(this.s){
case 358:switch(this.lk()){
case'Id':this.typeRefOptArgs({art:$.art},359);continue
case'type':this.lP()&&this.typeTypeOf({art:$.art},359);continue
case'localized':if(this.ckP(368,['Id'])){ $.art.localized = this.valueWithLocation( true ); }continue
case'association':if(this.ckP(370,['[','to'])){assoc=this.lb();this.elementRestriction(0,'calc')}continue;
case'composition':if(this.ckP(374,['[','of'])){assoc=this.lb();this.elementRestriction(0,'calc')}continue;
case'array':if(this.ckP(378,['of'])){this.elementRestriction(0,'calc')}continue;
case'many':if(this.ckP(379,['Id','{'])){this.elementRestriction(0,'calc'); $.art.items = { location: this.lb().location }; }continue
case'{':if(this.elementsBlock({art:$.art},385)){this.elementRestriction(0,'calc')}continue;
default:this.ei();continue
}
case 359:this.s=360;{ this.docComment( $.art ); }continue
case 360:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},360);continue
default:this.s=361;continue
}
case 361:switch(this.lk()){
case'not':case'null':if(this.gc(363,'elementRestriction','notNull')&&this.nullability({art:$.art},362)){ this.docComment( $.art ); }continue
default:this.s=363;continue
}
case 362:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},362);continue
default:this.s=363;continue
}
case 363:switch(this.lk()){
case'enum':if(this.enumSymbolsBlock({art:$.art},364)){this.elementRestriction(0,'anno')}continue;
case'@':case'not':case'null':case'default':this.typeProperties({art:$.art},0);continue
default:this.gr([]);continue
}
case 364:switch(this.lk()){
case'not':case'null':this.gc(365,'elementRestriction','notNull')&&this.nullability({art:$.art},365);continue
default:this.s=365;continue
}
case 365:switch(this.lk()){
case'default':this.gc(367,'elementRestriction','default')&&this.ck(366);continue
default:this.s=367;continue
}
case 366:if(this.expression(_={},367)){expr=_.expr; $.art.default = expr; }continue
case 367:switch(this.lk()){
case'not':case'null':this.gc(0,'elementRestriction','notNull')&&this.nullability({art:$.art},0);continue
default:this.gr([]);continue
}
case 368:if(this.typeRefOptArgs({art:$.art},369)){ this.docComment( $.art ); }continue
case 369:switch(this.lk()){
case'@':case'not':case'null':case'default':this.typeProperties({art:$.art},0);continue
default:this.gr([]);continue
}
case 370:switch(this.l()){
case'[':this.cardinality({art:$.art},371);continue
default:this.s=371;continue
}
case 371:this.mk(372,'to');continue
case 372:switch(this.lk()){
case'one':case'many':if(this.lP(['Id'])&&this.gc(373,'noRepeatedCardinality')&&this.ck(373))card=this.lb();continue
default:this.s=373;continue
}
case 373:this.typeAssocProperties({art:$.art,assoc,card},0);continue
case 374:switch(this.l()){
case'[':this.cardinality({art:$.art},375);continue
default:this.s=375;continue
}
case 375:this.mk(376,'of');continue
case 376:switch(this.lk()){
case'one':case'many':if(this.lP(['Id','{'])&&this.gc(377,'noRepeatedCardinality')&&this.ck(377))card=this.lb();continue
default:this.s=377;continue
}
case 377:switch(this.l()){
case'Id':this.typeAssocProperties({art:$.art,assoc,card},0);continue
case'{':if(this.elementsBlock({art:this.setAssocAndComposition( $.art, assoc, card )},0)){ $.art.target.location = $.art.target.elements[Symbol.for('cds.$location')]; }continue
default:this.e();continue
}
case 378:if(this.mk(379,'of')){ $.art.items = { location: this.locationOfPrevTokens( 2 ) }; }continue
case 379:switch(this.lk()){
case'Id':this.typeRefOptArgs({art:$.art.items},380);continue
case'type':this.lP()&&this.typeTypeOf({art:$.art.items},380);continue
case'{':this.elementsBlock({art:$.art.items},384);continue
default:this.ei();continue
}
case 380:switch(this.lk()){
case'not':case'null':this.gc(381,'elementRestriction','notNull')&&this.nullability({art:$.art.items},381);continue
default:this.s=381;continue
}
case 381:switch(this.lk()){
case'enum':this.enumSymbolsBlock({art:$.art.items},384);continue
default:this.s=382;{ this.docComment( $.art ); }continue
}
case 382:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},382);continue
default:this.s=383;continue
}
case 383:if(this.gr([])){ ; }continue
case 384:switch(this.lk()){
case'not':case'null':this.gc(0,'elementRestriction','notNull')&&this.nullability({art:$.art.items},0);continue
default:this.gr([]);continue
}
case 385:switch(this.lk()){
case'not':case'null':this.nullability({art:$.art},0);continue
default:this.gr([]);continue
}
default:return this.exit_()
}
}
typeAssocProperties($,$next){
let target;let cond;let _
this.rule_(387,$next)
for(;;)switch(this.s){
case 387:if(this.simplePath(_={category:'artref'},388)){target=_.ref; this.setAssocAndComposition( $.art, $.assoc, $.card, target );
this.docComment( $.art ); }continue
case 388:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},388);continue
default:this.s=389;continue
}
case 389:switch(this.lk()){
case'on':this.ck(390);continue
case'{':if(this.foreignKeysBlock({art:$.art},392)){ this.docComment( $.art ); }continue
case'@':case'not':case'null':case'default':this.typeProperties({art:$.art},0);continue
default:this.gr([]);continue
}
case 390:if(this.condition(_={},391)){cond=_.expr; $.art.on = cond;
this.docComment( $.art ); }continue
case 391:switch(this.l()){
case'@':this.annoAssignStd({art:$.art},391);continue
default:this.gr([]);continue
}
case 392:switch(this.lk()){
case'@':case'not':case'null':case'default':this.typeProperties({art:$.art},0);continue
default:this.gr([]);continue
}
default:return this.exit_()
}
}
typeProperties($,$next){
let expr;let _
this.rule_(394,$next)
for(;;)switch(this.s){
case 394:switch(this.lk()){
case'@':this.annoAssignStd({art:$.art},394);continue
case'not':case'null':if(this.gc(0,'elementRestriction','notNull')&&this.nullability({art:$.art},394)){ this.docComment( $.art ); }continue
case'default':this.gc(0,'elementRestriction','default')&&this.ck(395);continue
default:this.gr([]);continue
}
case 395:if(this.expression(_={},394)){expr=_.expr; $.art.default = expr; this.docComment( $.art ); }continue
default:return this.exit_()
}
}
typeTypeOf($,$next){
let location
let type;let _
this.rule_(397,$next)
for(;;)switch(this.s){
case 397:this.mk(398,'type');continue
case 398:if(this.mk(399,'of')){ location = this.locationOfPrevTokens( 2 ); }continue
case 399:if(this.simplePath(_={category:'ref'},400)){type=_.ref; $.art.type = type; }continue
case 400:switch(this.l()){
case':':if(this.c(401)){ type.scope = type.path.length; }continue
default:if(this.gr(['@'])){ type.scope = 'typeOf'; type.path.unshift( { id: 'type of', location } ); }continue
}
case 401:if(this.miA(402,'ref')){ type.path.push( this.identAst() ); }continue
case 402:switch(this.l()){
case'.':this.c(403);continue
default:this.gr(['@']);continue
}
case 403:if(this.miA(402,'ref')){ type.path.push( this.identAst() ); }continue
case 0:
this.attachLocation( $.art.type )
default:return this.exit_()
}
}
typeRefOptArgs($,$next,$startState){
let type=$.art.type
let open;let tok;let _
this.rule_($startState??405,$next)
for(;;)switch(this.s){
case 405:if(this.simplePath(_={category:'artref'},406)){type=_.ref; $.art.type = type; }continue
case 406:switch(this.l()){
case':':if(this.c(407)){ type.scope = type.path.length; }continue
case'(':if(this.c(411))open=this.lb();continue
default:this.gr([]);continue
}
case 407:if(this.miA(408,'ref')){ type.path.push( this.identAst() ); }continue
case 408:switch(this.l()){
case'.':this.c(409);continue
default:this.s=410;continue
}
case 409:if(this.miA(408,'ref')){ type.path.push( this.identAst() ); }continue
case 410:if(this.gr([])){ this.attachLocation( $.art.type ); }continue
case 411:switch(this.lk()){
case'Number':if(this.c(412)){ $.art.$typeArgs = this.createArray( open );
$.art.$typeArgs.push( this.unsignedIntegerLiteral() ); }continue
case'Id':this.s=415;{ $.art.$typeArgs = this.createDict( open ); }continue
default:this.ei();continue
}
case 412:switch(this.l()){
case',':this.c(413);continue
default:this.s=414;continue
}
case 413:switch(this.lk()){
case'Number':if(this.c(412)){ $.art.$typeArgs.push( this.unsignedIntegerLiteral() ); }continue
case'floating':case'variable':if(this.ck(412)){tok=this.lb(); $.art.$typeArgs.push( { literal: 'string', val: tok.keyword, location: tok.location } ); }continue
case')':this.s=414;continue
default:this.e();continue
}
case 414:this.s=417;{ this.checkTypeArgs( $.art ); }continue
case 415:switch(this.l()){
case'Id':this.typeNamedArg({art:$.art},416);continue
default:this.s=417;continue
}
case 416:switch(this.l()){
case',':this.c(415);continue
case')':this.s=417;continue
default:this.e();continue
}
case 417:if(this.m(0,')')){ if ($.art.$typeArgs) this.finalizeDictOrArray( $.art.$typeArgs ); }continue
default:return this.exit_()
}
}
typeNamedArgsList($,$next){
this.rule_(419,$next)
for(;;)switch(this.s){
case 419:if(this.m(420,'(')){ $.art.$typeArgs = this.createDict(); }continue
case 420:switch(this.l()){
case'Id':this.typeNamedArg({art:$.art},421);continue
default:this.s=422;continue
}
case 421:switch(this.l()){
case',':this.c(420);continue
case')':this.s=422;continue
default:this.e();continue
}
case 422:if(this.m(0,')')){ this.finalizeDictOrArray( $.art.$typeArgs ); }continue
default:return this.exit_()
}
}
typeNamedArg($,$next){
let name;let tok
this.rule_(424,$next)
for(;;)switch(this.s){
case 424:if(this.mi(425,'typeparamname'))name=this.lb();continue
case 425:this.m(426,':');continue
case 426:switch(this.lk()){
case'Number':if(this.c(0)){ this.setTypeFacet( $.art, name, this.unsignedIntegerLiteral() ); }continue
case'floating':case'variable':if(this.ck(0)){tok=this.lb(); this.setTypeFacet( $.art, name, { literal: 'string', val: tok.keyword, location: tok.location } ); }continue
default:this.e();continue
}
default:return this.exit_()
}
}
cardinality($,$next){
let card={}
this.rule_(428,$next)
for(;;)switch(this.s){
case 428:this.m(429,'[');continue
case 429:switch(this.l()){
case'*':if(this.c(430)){ card.targetMax = this.valueWithLocation(); }continue
case'Number':if(this.c(432)){ card.targetMax = this.unsignedIntegerLiteral(); }continue
default:this.s=434;{ card.targetMax = this.valueWithLocation( '*' ); }continue
}
case 430:switch(this.l()){
case',':this.c(431);continue
default:this.s=434;continue
}
case 431:this.targetCardinality({card,atAlt:false},434);continue
case 432:switch(this.l()){
case',':this.c(433);continue
case'..':this.targetCardinality({card,atAlt:true},434,437);continue
default:this.s=434;continue
}
case 433:this.targetCardinality({card,atAlt:false},434);continue
case 434:this.m(0,']');continue
default:
$.art.cardinality = this.attachLocation(card)
return this.exit_()
}
}
targetCardinality($,$next,$startState){
this.rule_($startState??436,$next)
{ if (!$.atAlt) $.card.sourceMax = $.card.targetMax; }
for(;;)switch(this.s){
case 436:switch(this.l()){
case'*':if(this.c(0)){ $.card.targetMax = this.valueWithLocation(); }continue
case'Number':if(this.c(437)){ $.card.targetMax = this.unsignedIntegerLiteral(); }continue
default:this.e();continue
}
case 437:switch(this.l()){
case'..':if(this.c(438)){ $.card.targetMin = $.card.targetMax; }continue
default:this.gr([']']);continue
}
case 438:switch(this.l()){
case'*':if(this.c(0)){ $.card.targetMax = this.valueWithLocation(); }continue
case'Number':if(this.c(0)){ $.card.targetMax = this.unsignedIntegerLiteral(); }continue
default:this.e();continue
}
default:return this.exit_()
}
}
nullability($,$next){
this.rule_(440,$next)
for(;;)switch(this.s){
case 440:switch(this.lk()){
case'null':if(this.ck(0)){ this.setNullability( $.art, false ); }continue
case'not':this.ck(441);continue
default:this.e();continue
}
case 441:if(this.mk(0,'null')){ this.setNullability( $.art, true, this.locationOfPrevTokens( 2 ) ); }continue
default:return this.exit_()
}
}
queryEOF($,$next){
$.query??=undefined
let _
this.rule_(443,$next)
for(;;)switch(this.s){
case 443:if(this.queryExpression(_={},444))$.query=_.expr;continue
case 444:switch(this.l()){
case';':this.c(445);continue
default:this.s=445;continue
}
case 445:this.m(0,'EOF');continue
default:return this.exit_()
}
}
projectionSpec($,$next){
$.query??={}
let tab;let _
this.rule_(447,$next)
for(;;)switch(this.s){
case 447:if(this.mk(448,'projection')){ $.query = { op: this.valueWithLocation( 'SELECT' ) }; }continue
case 448:this.mk(449,'on');continue
case 449:if(this.fromRefWithOptAlias(_={},450)){tab=_.expr; $.query.from = tab; }continue
case 450:switch(this.l()){
case'{':this.selectItemsList({query:$.query,start:undefined},451);continue
default:this.s=451;continue
}
case 451:switch(this.lk()){
case'excluding':this.excludingClause({query:$.query},0);continue
default:this.gr([';']);continue
}
default:
this.attachLocation($.query)
return this.exit_()
}
}
queryExpression($,$next,$startState){
$.expr??={}
let op;let quantifier
let query;let _
this.rule_($startState??453,$next)
for(;;)switch(this.s){
case 453:switch(this.l()){
case'(':this.c(454);continue
case'Id':if(this.selectQuery(_={},456))$.expr=_.query;continue
default:this.e();continue
}
case 454:this.queryExpression($,455);continue
case 455:if(this.m(456,')')){ this.surroundByParens( $.expr ); }continue
case 456:switch(this.lk()){
case'intersect':if(this.gc(460,'precLeft_',4)&&this.ck(457)){ op = this.valueWithLocation(); }continue
case'minus':case'except':if(this.gc(460,'precLeft_',2)&&this.ck(457)){ op = this.valueWithLocation(); }continue
case'union':if(this.gc(460,'precLeft_',2)&&this.ck(458)){ op = this.valueWithLocation(); }continue
default:this.s=460;continue
}
case 457:switch(this.lk()){
case'distinct':if(this.ck(459)){ quantifier = this.valueWithLocation(); }continue
default:this.s=459;continue
}
case 458:switch(this.lk()){
case'all':case'distinct':if(this.ck(459)){ quantifier = this.valueWithLocation(); }continue
default:this.s=459;continue
}
case 459:if(this.queryExpression(_={},456)){query=_.expr; if ($.expr.$parens || op.val !== $.expr.op?.val || quantifier?.val !== $.expr.quantifier?.val) $.expr = { op, args: [$.expr], quantifier, location: { ...$.expr.location } };
quantifier = undefined;
$.expr.args.push( query ); this.attachLocation( $.expr ); }continue
case 460:switch(this.lk()){
case'limit':case'order':if(this.gc(0,'precPost_',0)&&this.g(461)){ if ($.expr.$parens) { this.attachLocation( $.expr ); $.expr = { op: this.valueWithLocation( '$query', this.la() ), args: [ $.expr ] }; } }continue
default:this.gr([]);continue
}
case 461:this.orderByLimitOffset({query:$.expr},0);continue
default:
this.attachLocation( $.expr )
return this.exit_()
}
}
selectQuery($,$next){
$.query??={}
this.rule_(463,$next)
for(;;)switch(this.s){
case 463:if(this.mk(464,'select')){ $.query = { op: this.valueWithLocation( 'SELECT' ) }; }continue
case 464:switch(this.lk()){
case'from':this.ck(465);continue
case'all':case'distinct':if(this.ck(475)){ $.query.quantifier = this.valueWithLocation(); }continue
case'Id':case'#':case'(':case'*':case'+':case'-':case':':case'?':case'@':case'{':case'key':case'not':case'case':case'cast':case'null':case'true':case'false':case'Number':case'String':case'exists':case'QuotedLiteral':this.s=475;continue
default:this.ei();continue
}
case 465:this.querySource({query:$.query},466);continue
case 466:switch(this.lk()){
case'mixin':this.ck(467);continue
default:this.s=472;continue
}
case 467:if(this.m(468,'{')){ $.query.mixin = this.createDict(); }continue
case 468:switch(this.l()){
case'Id':this.mixinElementDef({outer:$.query},469);continue
default:this.s=470;continue
}
case 469:switch(this.l()){
case';':this.c(468);continue
case'}':this.s=470;continue
default:this.e();continue
}
case 470:if(this.m(471,'}')){ this.finalizeDictOrArray( $.query.mixin ); }continue
case 471:this.mk(472,'into');continue
case 472:switch(this.lk()){
case'all':case'distinct':if(this.ck(473)){ $.query.quantifier = this.valueWithLocation(); }continue
default:this.s=473;continue
}
case 473:switch(this.l()){
case'{':this.selectItemsList({query:$.query,start:undefined},474);continue
default:this.s=474;continue
}
case 474:switch(this.lk()){
case'excluding':this.excludingClause({query:$.query},481);continue
default:this.s=481;continue
}
case 475:this.s=476;{this.inSelectItem(0,'sqlStyle'); ; }continue
case 476:switch(this.l()){
case'*':if(this.c(477)){ $.query.columns = [ this.valueWithLocation() ]; }continue
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'@':case'{':case'Number':case'String':case'QuotedLiteral':this.selectItemDef({columns:($.query.columns = [])},477);continue
default:this.e();continue
}
case 477:switch(this.l()){
case',':this.c(478);continue
default:this.s=479;continue
}
case 478:switch(this.l()){
case'*':if(this.c(477)){ $.query.columns.push( this.valueWithLocation() ); }continue
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'@':case'{':case'Number':case'String':case'QuotedLiteral':this.selectItemDef({columns:$.query.columns},477);continue
default:this.e();continue
}
case 479:this.mk(480,'from');continue
case 480:this.querySource({query:$.query},481);continue
case 481:switch(this.lk()){
case'group':case'where':case'having':this.whereGroupByHaving({query:$.query},0);continue
default:this.gr(['limit','minus','order','union','except','intersect']);continue
}
default:
this.attachLocation($.query)
return this.exit_()
}
}
querySource($,$next){
let tab;let _
this.rule_(483,$next)
for(;;)switch(this.s){
case 483:if(this.tableExpression(_={},484)){tab=_.expr; $.query.from = tab; }continue
case 484:switch(this.l()){
case',':this.s=485;{ const { location } = this.la();
$.query.from = { op: { val: 'join', location }, join: { val: 'cross', location }, args: [tab] }; }continue
default:this.gr(['group','limit','minus','order','union','where','except','having','intersect']);continue
}
case 485:switch(this.l()){
case',':this.c(486);continue
default:this.gr(['group','limit','minus','order','union','where','except','having','intersect']);continue
}
case 486:if(this.tableExpression(_={},485)){tab=_.expr; $.query.from.args.push( tab ); }continue
case 0:
this.attachLocation($.query.from)
default:return this.exit_()
}
}
tableExpression($,$next,$startState){
$.expr??={}
let join;let tab;let card;let cond;let _
this.rule_($startState??488,$next)
for(;;)switch(this.s){
case 488:switch(this.l()){
case'(':this.tableOrQueryParens($,489);continue
case'Id':this.fromRefWithOptAlias($,490);continue
default:this.e();continue
}
case 489:this.s=490;{ $.expr = this.taggedIfQuery( $.expr ); }continue
case 490:switch(this.lk()){
case'cross':if(this.ck(491))join=this.lb();continue
case'inner':if(this.ck(494))join=this.lb();continue
case'full':case'left':case'right':if(this.ck(493))join=this.lb();continue
case'join':if(this.ck(496)){ join = undefined; }continue
default:this.gr([]);continue
}
case 491:if(this.mk(492,'join')){ if ($.expr?.join?.val !== 'cross' || $.expr.$parens) $.expr = { op: this.valueWithLocation(), join: this.valueWithLocation( undefined, join ), args: [ $.expr ] }; }continue
case 492:switch(this.l()){
case'(':if(this.tableOrQueryParens(_={},490)){tab=_.expr; const r = this.taggedIfQuery( tab ); if (r) $.expr.args.push( r );
this.attachLocation( $.expr ); }continue
case'Id':if(this.fromRefWithOptAlias(_={},490)){tab=_.expr; if (tab) $.expr.args.push( tab );
this.attachLocation( $.expr ); }continue
default:this.e();continue
}
case 493:switch(this.lk()){
case'outer':this.ck(494);continue
default:this.s=494;continue
}
case 494:switch(this.lk()){
case'one':case'many':case'exact':this.joinCardinality(card={},495);continue
default:this.s=495;continue
}
case 495:this.mk(496,'join');continue
case 496:this.s=497;{ $.expr = { op: this.valueWithLocation(), join: this.valueWithLocation( join?.keyword || 'inner', join ), args: [ $.expr ] }; if (card) $.expr.cardinality = card; card = undefined; }continue
case 497:if(this.tableExpression(_={},498)){tab=_.expr; $.expr.args.push( tab ); this.attachLocation( $.expr ); }continue
case 498:this.mk(499,'on');continue
case 499:if(this.condition(_={},490)){cond=_.expr; $.expr.on = cond;
this.attachLocation( $.expr ); }continue
default:return this.exit_()
}
}
tableOrQueryParens($,$next){
$.expr??=undefined
this.rule_(501,$next)
for(;;)switch(this.s){
case 501:if(this.m(502,'(')){this.queryOnLeft()}continue;
case 502:switch(this.lk()){
case'(':this.tableOrQueryParens($,503);continue
case'Id':if(this.tableExpression($,504)){this.queryOnLeft(0,'table')}continue;
case'select':this.queryExpression($,504);continue
default:this.ei();continue
}
case 503:switch(this.lk()){
case'full':case'join':case'left':case'cross':case'inner':case'right':if(this.tableExpression($,504,489)){this.queryOnLeft(0,'table')}continue;
case'limit':case'minus':case'order':case'union':case'except':case'intersect':this.gc(504,'queryOnLeft')&&this.queryExpression($,504,456);continue
default:this.s=504;continue
}
case 504:if(this.m(505,')')){ this.surroundByParens( $.expr ); }continue
case 505:switch(this.lk()){
case'as':this.gc(0,'queryOnLeft','table')&&this.ck(506);continue
case'Id':if(this.gc(0,'queryOnLeft','tableWithoutAs')&&this.ci(0,'FromAlias')){ $.expr = this.taggedIfQuery( $.expr ); $.expr.name = this.fragileAlias(); }continue
default:this.giR(0,['full','join','left','cross','inner','right']);continue
}
case 506:if(this.mi(0,'FromAlias')){ $.expr = this.taggedIfQuery( $.expr ); $.expr.name = this.identAst(); }continue
default:return this.exit_()
}
}
joinCardinality($,$next){
$.sourceMax??=undefined;$.targetMax??=undefined
this.rule_(508,$next)
for(;;)switch(this.s){
case 508:switch(this.lk()){
case'exact':if(this.ck(509)){ $.sourceMin = this.valueWithLocation( 1 ); }continue
case'one':this.s=509;continue
case'many':if(this.ck(510)){ $.sourceMax = this.valueWithLocation( '*' ); }continue
default:this.e();continue
}
case 509:if(this.mk(510,'one')){ $.sourceMax = this.valueWithLocation( 1 ); }continue
case 510:this.mk(511,'to');continue
case 511:switch(this.lk()){
case'exact':if(this.ck(512)){ $.targetMin = this.valueWithLocation( 1 ); }continue
case'one':this.s=512;continue
case'many':if(this.ck(0)){ $.targetMax = this.valueWithLocation( '*' ); }continue
default:this.e();continue
}
case 512:if(this.mk(0,'one')){ $.targetMax = this.valueWithLocation( 1 ); }continue
default:
this.attachLocation( $ )
return this.exit_()
}
}
fromRefWithOptAlias($,$next){
$.expr??={}
this.rule_(514,$next)
{ $.expr.path = []; }
for(;;)switch(this.s){
case 514:this.fromPath({table:$.expr,category:'artref'},515);continue
case 515:switch(this.l()){
case':':if(this.c(516)){ if (!$.expr.scope) $.expr.scope = $.expr.path.length; else {
this.warning( 'syntax-invalid-path-separator', this.lb(),
{ '#': 'colon', code: ':', newcode: '.' } );
} }continue
default:this.s=517;continue
}
case 516:this.fromPath({table:$.expr,category:'ref'},517);continue
case 517:switch(this.lk()){
case'as':this.ck(518);continue
case'Id':if(this.ci(0,'FromAlias')){ $.expr.name = this.fragileAlias(); }continue
default:this.giR(519);continue
}
case 518:if(this.mi(0,'FromAlias')){ $.expr.name = this.identAst(); }continue
case 519:if(this.gr([])){ this.classifyImplicitName( $.expr.scope ? 'FromElemImplicit' : 'FromImplicit', $.expr ); }continue
default:
this.attachLocation( $.expr )
return this.exit_()
}
}
fromPath($,$next){
let pathItem
this.rule_(521,$next)
for(;;)switch(this.s){
case 521:if(this.mi(522,$.category)){ $.table.path.push( pathItem = this.identAst() ); }continue
case 522:switch(this.l()){
case'(':case'[':if(this.fromArgumentsAndFilter({pathStep:pathItem},523)){ pathItem = null; }continue
default:this.s=523;continue
}
case 523:switch(this.l()){
case'.':if(this.gc(0,'notAfterEntityArgOrFilter')&&this.c(524)){ if (!pathItem && !$.table.scope) {
$.table.scope = $.table.path.length; $.category = 'ref';
this.warning( 'syntax-invalid-path-separator', this.lb(),
{ '#': 'dot', code: '.', newcode: ':' } );
} }continue
default:this.gr(['Id','as']);continue
}
case 524:if(this.miA(525,$.category)){ $.table.path.push( pathItem = this.identAst() ); }continue
case 525:switch(this.l()){
case'(':case'[':if(this.fromArgumentsAndFilter({pathStep:pathItem},523)){ pathItem = null; }continue
default:this.s=523;continue
}
default:
this.attachLocation( $.table.path )
return this.exit_()
}
}
fromArgumentsAndFilter($,$next){
this.rule_(527,$next)
for(;;)switch(this.s){
case 527:switch(this.l()){
case'(':if(this.c(528)){ $.pathStep.args = this.createDict(); $.pathStep.$syntax = ':'; }continue
default:this.s=532;continue
}
case 528:switch(this.lk()){
case'Id':this.s=529;continue
default:this.ei();continue
}
case 529:switch(this.l()){
case'Id':this.fromNamedArgument($,530);continue
default:this.s=531;continue
}
case 530:switch(this.l()){
case',':this.c(529);continue
case')':this.s=531;continue
default:this.e();continue
}
case 531:this.m(532,')');continue
case 532:switch(this.l()){
case'[':this.cardinalityAndFilter($,0);continue
default:this.gr(['Id','.','as']);continue
}
default:return this.exit_()
}
}
fromNamedArgument($,$next){
let name;let expr;let _
this.rule_(534,$next)
for(;;)switch(this.s){
case 534:if(this.mi(535,'paramname'))name=this.lb();continue
case 535:this.m(536,':');continue
case 536:if(this.expression(_={},0)){expr=_.expr; this.addDef( expr, $.pathStep, 'args', 0, this.identAst( name ) ); }continue
default:return this.exit_()
}
}
cardinalityAndFilter($,$next){
this.rule_(538,$next)
for(;;)switch(this.s){
case 538:this.m(539,'[');continue
case 539:switch(this.l()){
case'Number':if(this.gc(541,'beforeColon')&&this.c(540)){ $.pathStep.cardinality = { targetMax: this.unsignedIntegerLiteral(), location: this.lb().location }; }continue
default:this.s=541;continue
}
case 540:this.m(541,':');continue
case 541:this.filterClauses({pathStep:$.pathStep},542);continue
case 542:this.m(0,']');continue
default:return this.exit_()
}
}
filterClauses($,$next){
let cond;let _
this.rule_(544,$next)
for(;;)switch(this.s){
case 544:switch(this.lk()){
case'where':this.ck(545);continue
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'not':case'case':case'cast':case'null':case'true':case'false':case'Number':case'String':case'exists':case'QuotedLiteral':this.s=545;continue
case'group':case'limit':case'order':case'having':this.gP(546);continue
default:this.gi(546);continue
}
case 545:if(this.condition(_={},546)){cond=_.expr; $.pathStep.where = cond; }continue
case 546:switch(this.lk()){
case'group':this.s=547;{ this.csnParseOnly('syntax-unexpected-sql-clause', 1, { keyword: 'group by' }); }continue
default:this.s=548;continue
}
case 547:this.groupByClause({query:$.pathStep},548);continue
case 548:switch(this.lk()){
case'having':if(this.ck(549)){ this.csnParseOnly('syntax-unexpected-sql-clause', -1, { keyword: 'having' }); }continue
default:this.s=550;continue
}
case 549:if(this.condition(_={},550)){cond=_.expr; $.pathStep.having = cond; }continue
case 550:switch(this.lk()){
case'limit':case'order':this.s=551;{ if (this.lk() === 'limit') this.csnParseOnly('syntax-unexpected-sql-clause', 0, { keyword: 'limit' } ); else this.csnParseOnly('syntax-unexpected-sql-clause', 1, { keyword: 'order by' } ); }continue
default:this.gr([']']);continue
}
case 551:this.orderByLimitOffset({query:$.pathStep},0);continue
default:return this.exit_()
}
}
excludingClause($,$next){
this.rule_(553,$next)
for(;;)switch(this.s){
case 553:this.mk(554,'excluding');continue
case 554:if(this.m(555,'{')){ $.query.excludingDict = this.createDict(); }continue
case 555:switch(this.l()){
case'Id':this.s=556;continue
default:this.e();continue
}
case 556:switch(this.l()){
case'Id':if(this.ciA(557,'ref')){ this.addDef( { location: this.lb().location }, $.query, 'excludingDict', '', this.identAst() ); }continue
default:this.s=558;continue
}
case 557:switch(this.l()){
case',':this.c(556);continue
case'}':this.s=558;continue
default:this.e();continue
}
case 558:if(this.m(0,'}')){this.afterBrace(); this.finalizeDictOrArray( $.query.excludingDict ); }continue
default:return this.exit_()
}
}
selectItemsList($,$next){
this.rule_(560,$next)
for(;;)switch(this.s){
case 560:if(this.m(561,'{')){this.inSelectItem(0,'top'); $.query.columns = this.createArray( $.start ); }continue
case 561:switch(this.l()){
case'*':if(this.c(562)){ $.query.columns.push( this.valueWithLocation() ); }continue
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'@':case'{':case'Number':case'String':case'QuotedLiteral':this.selectItemDef({columns:$.query.columns},562);continue
default:this.s=563;continue
}
case 562:switch(this.l()){
case',':this.c(561);continue
case'}':this.s=563;continue
default:this.e();continue
}
case 563:if(this.m(0,'}')){this.afterBrace(); this.finalizeDictOrArray( $.query.columns ); }continue
default:return this.exit_()
}
}
nestedSelectItemsList($,$next){
this.rule_(565,$next)
for(;;)switch(this.s){
case 565:if(this.m(566,'{')){this.inSelectItem(); $.query[$.clause] = this.createArray(); }continue
case 566:switch(this.l()){
case'*':if(this.c(567)){ $.query[$.clause].push( this.valueWithLocation() ); }continue
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'@':case'{':case'Number':case'String':case'QuotedLiteral':this.selectItemDef({columns:$.query[$.clause]},567);continue
default:this.s=568;continue
}
case 567:switch(this.l()){
case',':this.c(566);continue
case'}':this.s=568;continue
default:this.e();continue
}
case 568:if(this.m(0,'}')){this.afterBrace(); this.finalizeDictOrArray( $.query[$.clause] ); }continue
default:return this.exit_()
}
}
selectItemDef($,$next){
let art=new XsnArtifact()
let expr;let e;let target;let cond;let assoc;let card;let _
this.rule_(570,$next)
{ $.columns.push( art );
this.docComment( art ); }
for(;;)switch(this.s){
case 570:switch(this.l()){
case'@':this.annoAssignCol({art},570);continue
default:this.s=571;continue
}
case 571:switch(this.lk()){
case'virtual':if(this.lP(['Id','#','(','+','-',':','?','{','key','not','case','cast','null','true','false','Number','String','exists','QuotedLiteral'])&&this.gc(572,'modifierRestriction')&&this.ck(572)){ art.virtual = this.valueWithLocation( true ); }continue
default:this.s=572;continue
}
case 572:this.s=573;{this.columnExpr(0,'key'); ; }continue
case 573:switch(this.lk()){
case'key':if(this.gc(574,'modifierRestriction')&&this.ck(574)){ art.key = this.valueWithLocation( true ); }continue
default:this.s=574;continue
}
case 574:switch(this.lk()){
case'#':case'(':case'+':case'-':case':':case'?':case'new':case'not':case'case':case'cast':case'null':case'true':case'false':case'Number':case'String':case'exists':case'QuotedLiteral':if(this.lP()&&this.expression(_={},575)){expr=_.expr; art.value = expr; }continue
case'Id':if(this.valuePath(_={},577)){expr=_.expr; expr = this.valuePathAst( expr ); art.value = expr; }continue
case'{':this.nestedSelectItemsList({query:art,clause:'expand'},588);continue
default:this.ei();continue
}
case 575:switch(this.lk()){
case'as':this.ck(576);continue
case'Id':if(this.ci(585,'ItemAlias')){ art.name = this.fragileAlias( true ); }continue
default:this.gi(585);continue
}
case 576:if(this.mi(585,'ItemAlias')){ art.name = this.identAst(); }continue
case 577:switch(this.lk()){
case'over':if(this.ck(578)){ this.pushXprToken( expr.suffix = [] ); }continue
case'*':case'+':case'-':case'/':case'<':case'=':case'>':case'?':case'!=':case'<=':case'<>':case'==':case'>=':case'in':case'is':case'or':case'||':case'and':case'not':case'like':case'between':if(this.expression(_={ expr: expr },580,652)){e=_.expr; Object.assign( e.location || {}, expr.location ); art.value = this.attachLocation( e ) }continue
case'as':this.ck(582);continue
case'Id':if(this.ci(585,'ItemAlias')){this.nestedExpand(); art.name = this.fragileAlias( true ); }continue
case'.':if(this.c(583)){ this.reportUnexpectedSpace( this.lb(), this.la().location, true );
this.reportExpandInline( art, true ); }continue
default:if(this.gi(585)){this.nestedExpand(); this.classifyImplicitName( 'ItemImplicit', expr ); }continue
}
case 578:this.overClause({outer:expr.suffix},579);continue
case 579:switch(this.lk()){
case'*':case'+':case'-':case'/':case'<':case'=':case'>':case'?':case'!=':case'<=':case'<>':case'==':case'>=':case'in':case'is':case'or':case'||':case'and':case'not':case'like':case'between':if(this.expression(_={ expr: expr },580,652)){e=_.expr; Object.assign( e.location || {}, expr.location ); art.value = this.attachLocation( e ) }continue
default:this.s=580;continue
}
case 580:switch(this.lk()){
case'as':this.ck(581);continue
case'Id':if(this.ci(585,'ItemAlias')){ art.name = this.fragileAlias( true ); }continue
default:this.gi(585);continue
}
case 581:if(this.mi(585,'ItemAlias')){ art.name = this.identAst(); }continue
case 582:if(this.mi(585,'ItemAlias')){this.nestedExpand(); art.name = this.identAst(); }continue
case 583:switch(this.l()){
case'{':this.nestedSelectItemsList({query:art,clause:'inline'},584);continue
case'*':if(this.c(0)){ art.inline = [ this.valueWithLocation() ]; }continue
default:this.e();continue
}
case 584:switch(this.lk()){
case'excluding':this.excludingClause({query:art},0);continue
default:this.gr([',']);continue
}
case 585:switch(this.l()){
case'{':if(this.gc(591,'nestedExpand')&&this.g(586)){ if (!this.nestedExpand(true)) this.reportExpandInline( art, false ); }continue
default:this.s=591;continue
}
case 586:this.nestedSelectItemsList({query:art,clause:'expand'},587);continue
case 587:switch(this.lk()){
case'excluding':this.excludingClause({query:art},591);continue
default:this.s=591;continue
}
case 588:switch(this.lk()){
case'excluding':this.excludingClause({query:art},589);continue
default:this.s=589;continue
}
case 589:this.mk(590,'as');continue
case 590:if(this.mi(591,'ItemAlias')){ art.name = this.identAst(); }continue
case 591:this.s=592;{this.columnExpr(); this.docComment( art ); }continue
case 592:switch(this.l()){
case'@':this.annoAssignMid({art},592);continue
default:this.s=593;continue
}
case 593:switch(this.l()){
case':':this.c(594);continue
default:this.gr([',']);continue
}
case 594:switch(this.lk()){
case'type':this.lP()&&this.typeTypeOf({art},608);continue
case'localized':if(this.ckP(595,['Id'])){ art.localized = this.valueWithLocation( true ); }continue
case'Id':this.s=595;continue
case'redirected':this.ckP(596,['to']);continue
case'association':if(this.lP(['[','to'])&&this.ec('columnExpr')&&this.ck(600)){assoc=this.lb(); this.associationInSelectItem( art ); }continue
case'composition':if(this.lP(['[','of'])&&this.ec('columnExpr')&&this.ck(602)){assoc=this.lb(); this.associationInSelectItem( art ); }continue
default:this.ei();continue
}
case 595:this.typeRefOptArgs({art},608);continue
case 596:this.mk(597,'to');continue
case 597:if(this.simplePath(_={category:'artref'},598)){target=_.ref; art.target = target; }continue
case 598:switch(this.lk()){
case'on':this.ck(599);continue
case'{':this.foreignKeysBlock({art},608);continue
default:this.s=608;continue
}
case 599:if(this.condition(_={},608)){cond=_.expr; art.on = cond; }continue
case 600:switch(this.l()){
case'[':this.cardinality({art},601);continue
default:this.s=601;continue
}
case 601:this.mk(604,'to');continue
case 602:switch(this.l()){
case'[':this.cardinality({art},603);continue
default:this.s=603;continue
}
case 603:this.mk(604,'of');continue
case 604:switch(this.lk()){
case'one':case'many':if(this.lP(['Id'])&&this.gc(605,'noRepeatedCardinality')&&this.ck(605))card=this.lb();continue
default:this.s=605;continue
}
case 605:if(this.simplePath(_={category:'artref'},606)){target=_.ref; this.setAssocAndComposition( art, assoc, card, target ); }continue
case 606:this.mk(607,'on');continue
case 607:if(this.condition(_={},608)){expr=_.expr; art.on = expr; }continue
case 608:this.s=609;{ this.docComment( art ); }continue
case 609:switch(this.l()){
case'@':this.annoAssignStd({art},609);continue
default:this.gr([',']);continue
}
default:
this.attachLocation( art )
return this.exit_()
}
}
whereGroupByHaving($,$next){
let cond;let _
this.rule_(611,$next)
for(;;)switch(this.s){
case 611:switch(this.lk()){
case'where':this.ck(612);continue
default:this.s=613;continue
}
case 612:if(this.condition(_={},613)){cond=_.expr; $.query.where = cond; }continue
case 613:switch(this.lk()){
case'group':this.groupByClause($,614);continue
default:this.s=614;continue
}
case 614:switch(this.lk()){
case'having':this.ck(615);continue
default:this.gr(['limit','order']);continue
}
case 615:if(this.condition(_={},0)){cond=_.expr; $.query.having = cond; }continue
default:return this.exit_()
}
}
groupByClause($,$next){
let expr;let _
this.rule_(617,$next)
for(;;)switch(this.s){
case 617:this.mk(618,'group');continue
case 618:this.mk(619,'by');continue
case 619:if(this.expression(_={},620)){expr=_.expr; $.query.groupBy = [ expr ]; }continue
case 620:switch(this.l()){
case',':this.c(621);continue
default:this.gr(['limit','order','having']);continue
}
case 621:if(this.expression(_={},620)){expr=_.expr; $.query.groupBy.push( expr ); }continue
default:return this.exit_()
}
}
orderByLimitOffset($,$next){
let expr;let _
this.rule_(623,$next)
for(;;)switch(this.s){
case 623:switch(this.lk()){
case'order':this.orderByClause($,624);continue
default:this.s=624;continue
}
case 624:switch(this.lk()){
case'limit':this.ck(625);continue
default:this.gr([]);continue
}
case 625:if(this.expression(_={},626)){expr=_.expr; $.query.limit = { rows: expr }; }continue
case 626:switch(this.lk()){
case'offset':this.ck(627);continue
default:this.gr([]);continue
}
case 627:if(this.expression(_={},0)){expr=_.expr; $.query.limit.offset = expr; }continue
default:return this.exit_()
}
}
orderByClause($,$next){
let expr;let _
this.rule_(629,$next)
for(;;)switch(this.s){
case 629:this.mk(630,'order');continue
case 630:this.mk(631,'by');continue
case 631:if(this.orderByExpression(_={},632)){expr=_.expr; $.query.orderBy = [ expr ]; }continue
case 632:switch(this.l()){
case',':this.c(633);continue
default:this.gr(['limit']);continue
}
case 633:if(this.orderByExpression(_={},632)){expr=_.expr; $.query.orderBy.push( expr ); }continue
default:return this.exit_()
}
}
orderByExpression($,$next){
$.expr??=undefined
this.rule_(635,$next)
for(;;)switch(this.s){
case 635:this.expression($,636);continue
case 636:switch(this.lk()){
case'asc':case'desc':if(this.ck(637)){ $.expr.sort = this.valueWithLocation(); }continue
default:this.s=637;continue
}
case 637:switch(this.lk()){
case'nulls':this.ck(638);continue
default:this.gr([',','limit']);continue
}
case 638:switch(this.lk()){
case'last':case'first':if(this.ck(0)){ $.expr.nulls = this.valueWithLocation(); }continue
default:this.e();continue
}
default:return this.exit_()
}
}
conditionEOF($,$next){
$.cond??=undefined
let _
this.rule_(640,$next)
for(;;)switch(this.s){
case 640:if(this.expression(_={},641))$.cond=_.expr;continue
case 641:this.m(0,'EOF');continue
default:return this.exit_()
}
}
condition($,$next){
$.expr??=undefined
this.rule_(643,$next)
for(;;)switch(this.s){
case 643:this.expression($,0);continue
default:return this.exit_()
}
}
valuePath($,$next,$startState){
$.expr??={ path: [] }
let pathItem
this.rule_($startState??645,$next)
for(;;)switch(this.s){
case 645:if(this.mi(646,'ref')){ $.expr.path.push( pathItem = this.identAst() ); }continue
case 646:switch(this.l()){
case'(':case'[':this.argumentsAndFilter({pathStep:pathItem},647);continue
default:this.s=647;continue
}
case 647:switch(this.l()){
case'.':this.gc(0,'isDotForPath')&&this.c(648);continue
default:this.gr(['*','+','-','/','<','=','>','?','!=','<=','<>','==','>=','in','is','or','||','and','not','like','between']);continue
}
case 648:if(this.miA(649,'ref')){ $.expr.path.push( pathItem = this.identAst() ); }continue
case 649:switch(this.l()){
case'(':case'[':if(this.argumentsAndFilter({pathStep:pathItem},647)){ pathItem = null; }continue
default:this.s=647;continue
}
default:
this.attachLocation( $.expr )
return this.exit_()
}
}
expression($,$next,$startState){
$.expr??={}
let e;let open;let _
this.rule_($startState??651,$next)
for(;;)switch(this.s){
case 651:switch(this.lk()){
case'(':this.expressionOrQueryParens($,652);continue
case'#':case'null':case'true':case'false':case'Number':case'String':case'QuotedLiteral':this.literalValue($,662);continue
case':':if(this.c(653)){ this.reportUnexpectedSpace(); }continue
case'?':if(this.c(662)){ this.csnParseOnly( 'syntax-unsupported-param', -1, { '#': 'dynamic', code: '?' } );
$.expr = this.attachLocation({ param: this.valueWithLocation(), scope: 'param' }); }continue
case'Id':if(this.valuePath(_={},655)){e=_.expr; $.expr = this.valuePathAst( e ); }continue
case'new':this.lP()&&this.newAndValuePath($,662);continue
case'exists':if(this.ck(658)){ $.expr = this.applyOpToken(); }continue
case'case':this.caseExpression($,662);continue
case'cast':this.castFunction($,662);continue
case'+':case'-':if(this.ec('precRight_',30)&&this.c(661)){ $.expr = this.applyOpToken(); }continue
case'not':if(this.ec('precRight_',8)&&this.ck(661)){ $.expr = this.applyOpToken(); }continue
default:this.ei();continue
}
case 652:this.s=662;{ $.expr = this.taggedIfQuery( $.expr ); }continue
case 653:switch(this.l()){
case'Id':if(this.ciA(654,'paramref')){ $.expr = { path: [ this.identAst() ], location: this.startLocation(), scope: 'param' }; }continue
case'Number':if(this.c(662)){ this.csnParseOnly( 'syntax-unsupported-param', -1, { '#': 'positional', code: ':' + this.lb().text } );
$.expr = this.attachLocation({ param: this.unsignedIntegerLiteral(), scope: 'param' }); }continue
default:this.e();continue
}
case 654:switch(this.l()){
case'.':if(this.valuePath($,662,647)){ $.expr = this.valuePathAst( $.expr ); }continue
default:this.s=662;{ this.attachLocation( $.expr ); }continue
}
case 655:switch(this.lk()){
case'over':if(this.ck(656)){ this.pushXprToken( $.expr.suffix = [] ); }continue
default:this.s=657;continue
}
case 656:this.overClause(e={outer:$.expr.suffix},657);continue
case 657:this.s=662;{ this.attachLocation( $.expr ); }continue
case 658:switch(this.l()){
case'(':if(this.c(659))open=this.lb();continue
case'Id':if(this.valuePath(_={},662)){e=_.expr; e = this.valuePathAst( e ); e.$expected = 'exists';
$.expr.args.push( e ); this.attachLocation( $.expr ); }continue
case'?':if(this.c(662)){ this.csnParseOnly( 'syntax-unsupported-param', -1, { '#': 'dynamic', code: '?' } );
$.expr.args.push( { param: this.valueWithLocation(), scope: 'param' } ); this.attachLocation( $.expr ); }continue
default:this.e();continue
}
case 659:if(this.queryExpression(_={},660))e=_.expr;continue
case 660:if(this.m(662,')')){ $.expr.args.push( this.taggedIfQuery( this.surroundByParens( e, open ) ) );
this.attachLocation( $.expr ); }continue
case 661:if(this.expression(_={},662)){e=_.expr; $.expr = this.signedExpression( $.expr, e ); }continue
case 662:switch(this.lk()){
case'*':case'/':if(this.gc(0,'precLeft_',24)&&this.c(666)){ $.expr = this.applyOpToken( $.expr, 'nary' ); }continue
case'+':case'-':if(this.gc(0,'precLeft_',22)&&this.c(666)){ $.expr = this.applyOpToken( $.expr, 'nary' ); }continue
case'||':if(this.gc(0,'precLeft_',20)&&this.c(666)){ $.expr = this.applyOpToken( $.expr, 'nary' ); }continue
case'and':if(this.gc(0,'precLeft_',4)&&this.ck(666)){ $.expr = this.applyOpToken( $.expr, 'nary' ); }continue
case'or':if(this.gc(0,'precLeft_',2)&&this.ck(666)){ $.expr = this.applyOpToken( $.expr, 'nary' ); }continue
case'?':if(this.gc(0,'precLeft_',0)&&this.c(663)){ $.expr = this.applyOpToken( $.expr, '?:' ); }continue
case'<':case'=':case'>':case'!=':case'<=':case'<>':case'>=':if(this.gc(0,'precNone_',10)&&this.c(665)){ $.expr = this.applyOpToken( $.expr ); }continue
case'==':if(this.gc(0,'precNone_',10)&&this.c(666)){ $.expr = this.applyOpToken( $.expr ); }continue
case'is':if(this.gc(0,'precNone_',10)&&this.ck(667)){ $.expr = this.applyOpToken( $.expr ); }continue
case'not':if(this.gc(0,'isNegatedRelation','10')&&this.ck(669)){ $.expr = this.applyOpToken( $.expr ); }continue
case'in':case'like':case'between':if(this.gc(0,'precNone_',10)&&this.g(669)){ $.expr = { op: { val: 'ixpr', location: this.la().location }, args: [ $.expr ] }; }continue
default:this.gr([]);continue
}
case 663:if(this.expression(_={},664)){e=_.expr; $.expr.args.push( e ); }continue
case 664:if(this.m(666,':')){ this.pushXprToken( $.expr ); }continue
case 665:switch(this.lk()){
case'all':case'any':case'some':if(this.ck(666)){ this.pushXprToken( $.expr ); }continue
default:this.s=666;continue
}
case 666:if(this.expression(_={},677)){e=_.expr; $.expr.args.push( e ); }continue
case 667:switch(this.lk()){
case'not':if(this.ck(668)){ this.pushXprToken( $.expr ); }continue
default:this.s=668;continue
}
case 668:if(this.mk(677,'null')){ this.pushXprToken( $.expr ); }continue
case 669:switch(this.lk()){
case'between':if(this.ck(670)){ this.pushXprToken( $.expr ); }continue
case'in':if(this.ck(673)){ this.pushXprToken( $.expr ); }continue
case'like':if(this.ck(674)){ this.pushXprToken( $.expr ); }continue
default:this.e();continue
}
case 670:if(this.expression(_={},671)){e=_.expr; $.expr.args?.push( e ); }continue
case 671:if(this.mk(672,'and')){ this.pushXprToken( $.expr ); }continue
case 672:if(this.expression(_={},677)){e=_.expr; $.expr.args?.push( e ); }continue
case 673:if(this.expression(_={},677)){e=_.expr; $.expr.args?.push( this.secureParens( e ) ); }continue
case 674:if(this.expression(_={},675)){e=_.expr; $.expr.args?.push( e ); }continue
case 675:switch(this.lk()){
case'escape':if(this.ck(676)){ this.pushXprToken( $.expr ); }continue
default:this.s=677;continue
}
case 676:if(this.expression(_={},677)){e=_.expr; $.expr.args?.push( e ); }continue
case 677:this.s=662;{ this.attachLocation( $.expr ); }continue
default:
if (this.s == null) this.attachLocation( $.expr )
return this.exit_()
}
}
expressionOrQueryParens($,$next){
$.expr??=undefined
this.rule_(679,$next)
for(;;)switch(this.s){
case 679:if(this.m(680,'(')){this.queryOnLeft()}continue;
case 680:switch(this.lk()){
case'(':this.expressionOrQueryParens($,681);continue
case'Id':case'#':case'+':case'-':case':':case'?':case'not':case'case':case'cast':case'null':case'true':case'false':case'Number':case'String':case'exists':case'QuotedLiteral':if(this.expression($,683)){this.queryOnLeft(0,'expr')}continue;
case'select':this.queryExpression($,684);continue
default:this.ei();continue
}
case 681:switch(this.lk()){
case'*':case'+':case'-':case'/':case'<':case'=':case'>':case'?':case'!=':case'<=':case'<>':case'==':case'>=':case'in':case'is':case'or':case'||':case'and':case'not':case'like':case'between':if(this.expression($,682,652)){this.queryOnLeft(0,'expr')}continue;
case',':if(this.continueExpressionslist($,684)){this.queryOnLeft(0,'expr')}continue;
case'limit':case'minus':case'order':case'union':case'except':case'intersect':this.gc(684,'queryOnLeft')&&this.queryExpression($,684,456);continue
default:this.s=684;continue
}
case 682:switch(this.l()){
case',':this.continueExpressionslist($,684);continue
default:this.s=684;continue
}
case 683:switch(this.l()){
case',':this.continueExpressionslist($,684);continue
default:this.s=684;continue
}
case 684:if(this.m(0,')')){ this.surroundByParens( $.expr ); }continue
default:return this.exit_()
}
}
continueExpressionslist($,$next){
let e;let _
this.rule_(686,$next)
for(;;)switch(this.s){
case 686:if(this.m(687,',')){ $.expr = { op: this.valueWithLocation( 'list' ), args: [ $.expr ], location: { ... $.expr.$parens?.at( -1 ) ?? $.expr.location } }; }continue
case 687:switch(this.lk()){
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'not':case'case':case'cast':case'null':case'true':case'false':case'Number':case'String':case'exists':case'QuotedLiteral':this.s=688;continue
default:this.ei();continue
}
case 688:switch(this.lk()){
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'not':case'case':case'cast':case'null':case'true':case'false':case'Number':case'String':case'exists':case'QuotedLiteral':if(this.expression(_={},689)){e=_.expr; $.expr.args.push( e ); }continue
default:this.gi(0,[')']);continue
}
case 689:switch(this.l()){
case',':this.c(688);continue
default:this.gr([')']);continue
}
case 0:{ this.attachLocation( $.expr ); }
default:
this.attachLocation( $.expr )
return this.exit_()
}
}
newAndValuePath($,$next){
$.expr??=undefined
let e;let _
this.rule_(691,$next)
for(;;)switch(this.s){
case 691:if(this.mk(692,'new')){ $.expr = this.applyOpToken(); }continue
case 692:if(this.valuePath(_={},0)){e=_.expr; e = this.valuePathAst( e );
if (e.op?.val !== 'ixpr') $.expr.args.push( e ); else $.expr.args.push( ...e.args ); }continue
default:
this.attachLocation( $.expr )
return this.exit_()
}
}
caseExpression($,$next){
$.expr??=undefined
let e;let _
this.rule_(694,$next)
for(;;)switch(this.s){
case 694:if(this.mk(695,'case')){ $.expr.op = { val: 'ixpr', location: this.lb().location }; $.expr.args = []; this.pushXprToken( $.expr ); }continue
case 695:switch(this.lk()){
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'not':case'case':case'cast':case'null':case'true':case'false':case'Number':case'String':case'exists':case'QuotedLiteral':if(this.expression(_={},696)){e=_.expr; $.expr.args.push( e ); }continue
default:this.gi(696);continue
}
case 696:switch(this.lk()){
case'when':this.s=697;continue
default:this.e();continue
}
case 697:switch(this.lk()){
case'when':if(this.ck(698)){ this.pushXprToken( $.expr ); }continue
default:this.s=701;continue
}
case 698:if(this.expression(_={},699)){e=_.expr; $.expr.args.push( e ); }continue
case 699:if(this.mk(700,'then')){ this.pushXprToken( $.expr ); }continue
case 700:if(this.expression(_={},697)){e=_.expr; $.expr.args.push( e ); }continue
case 701:switch(this.lk()){
case'else':if(this.ck(702)){ this.pushXprToken( $.expr ); }continue
default:this.s=703;continue
}
case 702:if(this.expression(_={},703)){e=_.expr; $.expr.args.push( e ); }continue
case 703:if(this.mk(0,'end')){ this.pushXprToken( $.expr ); }continue
default:
this.attachLocation( $.expr )
return this.exit_()
}
}
castFunction($,$next){
$.expr??=undefined
let arg;let _
this.rule_(705,$next)
for(;;)switch(this.s){
case 705:if(this.mk(706,'cast')){ $.expr.op = this.valueWithLocation(); }continue
case 706:if(this.m(707,'(')){ $.expr.args = this.createArray(); }continue
case 707:if(this.expression(_={},708)){arg=_.expr; $.expr.args?.push( arg ); }continue
case 708:this.mk(709,'as');continue
case 709:this.typeRefOptArgs({art:$.expr},710);continue
case 710:if(this.m(0,')')){ this.finalizeDictOrArray( $.expr.args ); }continue
default:
this.attachLocation( $.expr )
return this.exit_()
}
}
argumentsAndFilter($,$next){
let open;let id;let expr;let _
this.rule_(712,$next)
for(;;)switch(this.s){
case 712:switch(this.l()){
case'(':if(this.c(713)){open=this.lb();this.prepareSpecialFunction(); $.pathStep.args = this.createArray(); }continue
default:this.s=732;continue
}
case 713:switch(this.l()){
case'Id':if(this.gc(725,'isNamedArg')&&this.ciA(714,'paramname'))id=this.lb();continue
default:this.s=725;continue
}
case 714:switch(this.l()){
case':':if(this.c(715)){ $.pathStep.args = this.createDict( open ); $.pathStep.$syntax = ':'; }continue
case'=>':if(this.c(720)){ $.pathStep.args = this.createDict(); }continue
default:this.e();continue
}
case 715:if(this.expression(_={},716)){expr=_.expr; this.addNamedArg( $.pathStep, id, expr ); }continue
case 716:switch(this.l()){
case',':this.c(717);continue
default:this.s=731;continue
}
case 717:switch(this.l()){
case'Id':if(this.ciA(718,'paramname'))id=this.lb();continue
case')':this.s=731;continue
default:this.e();continue
}
case 718:this.m(719,':');continue
case 719:if(this.expression(_={},716)){expr=_.expr; this.addNamedArg( $.pathStep, id, expr ); }continue
case 720:if(this.expression(_={},721)){expr=_.expr; this.addNamedArg( $.pathStep, id, expr ); }continue
case 721:switch(this.l()){
case',':this.c(722);continue
default:this.s=731;continue
}
case 722:switch(this.l()){
case'Id':if(this.ciA(723,'paramname'))id=this.lb();continue
case')':this.s=731;continue
default:this.e();continue
}
case 723:this.m(724,'=>');continue
case 724:if(this.expression(_={},721)){expr=_.expr; this.addNamedArg( $.pathStep, id, expr ); }continue
case 725:switch(this.l()){
case'Id':case'#':case'(':case'*':case'+':case'-':case':':case'?':case'Id_all':case'Number':case'String':case'QuotedLiteral':case'DeleteStarFromSet':if(this.funcExpression(_={},726)){expr=_.expr; $.pathStep.args.push( expr ); }continue
default:this.s=731;continue
}
case 726:switch(this.l()){
case',':if(this.c(727)){this.nextFunctionArgument()}continue;
default:this.s=728;continue
}
case 727:switch(this.lk()){
case'Id':case'#':case'(':case'*':case'+':case'-':case':':case'?':case'not':case'case':case'cast':case'null':case'true':case'false':case'Id_all':case'Number':case'String':case'exists':case'QuotedLiteral':case'DeleteStarFromSet':if(this.funcExpression(_={},726)){expr=_.expr; $.pathStep.args.push( expr ); }continue
case')':case'order':this.lP()&&this.ec('atRightParen')&&this.g(728);continue
default:this.ei();continue
}
case 728:switch(this.lk()){
case'order':if(this.ck(729)){ expr = $.pathStep.args[$.pathStep.args.length - 1] = this.applyOpToken( expr ); }continue
default:this.s=731;continue
}
case 729:if(this.mk(730,'by')){ this.pushXprToken( expr ); }continue
case 730:if(this.orderByClauseAsXpr({outer:expr.args},731)){ this.attachLocation( expr ); }continue
case 731:if(this.m(732,')')){ this.finalizeDictOrArray( $.pathStep.args ); }continue
case 732:switch(this.l()){
case'[':this.cardinalityAndFilter($,0);continue
default:this.gr(['*','+','-','.','/','<','=','>','?','!=','<=','<>','==','>=','in','is','or','||','and','not','like','between']);continue
}
default:return this.exit_()
}
}
funcExpression($,$next){
$.expr??=undefined
let args
let tok;let e;let _
this.rule_(734,$next)
for(;;)switch(this.s){
case 734:switch(this.lGenericIntroOrExpr()){
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'Number':case'String':case'QuotedLiteral':if(this.expression(_={},736))$.expr=_.expr;continue
case'GenericExpr':if(this.ckA(736)){tok=this.lb(); $.expr = { val: tok.keyword ?? tok.type, location: tok.location, literal: 'token' }; }continue
case'GenericIntro':if(this.ckA(735)){ $.expr = this.applyOpToken(); args = $.expr.args; }continue
default:this.e();continue
}
case 735:if(this.expression(_={},736)){e=_.expr; $.expr.args.push( e ); }continue
case 736:switch(this.lGenericSeparator()){
case'GenericSeparator':if(this.ckA(737)){ if (args) this.pushXprToken( args ); else { $.expr= this.applyOpToken( $.expr ); args = $.expr.args; } }continue
default:this.gr([')',',','order']);continue
}
case 737:switch(this.lGenericExpr()){
case'Id':case'#':case'(':case'+':case'-':case':':case'?':case'Number':case'String':case'QuotedLiteral':if(this.expression(_={},736)){e=_.expr; args.push( e ); }continue
case'GenericExpr':if(this.ckA(736)){ this.pushXprToken( args ); }continue
default:this.e();continue
}
default:
this.attachLocation( $.expr )
return this.exit_()
}
}
overClause($,$next){
let over=[]
this.rule_(739,$next)
for(;;)switch(this.s){
case 739:this.m(740,'(');continue
case 740:switch(this.lk()){
case'partition':if(this.ck(741)){ this.pushXprToken( over ); }continue
default:this.s=743;continue
}
case 741:if(this.mk(742,'by')){ this.pushXprToken( over ); }continue
case 742:this.expressionsAsXpr({outer:over},743);continue
case 743:switch(this.lk()){
case'order':if(this.ck(744)){ this.pushXprToken( over ); }continue
default:this.s=746;continue
}
case 744:if(this.mk(745,'by')){ this.pushXprToken( over ); }continue
case 745:this.orderByClauseAsXpr({outer:over},746);continue
case 746:switch(this.lk()){
case'rows':if(this.ck(747)){ this.pushXprToken( over ); }continue
default:this.s=748;continue
}
case 747:this.windowFrameClause({outer:over},748);continue
case 748:this.m(0,')');continue
default:
$.outer.push( this.surroundByParens( this.ixprAst( over ) ) )
return this.exit_()
}
}
expressionsAsXpr($,$next){
let args=[]
let expr;let _
this.rule_(750,$next)
for(;;)switch(this.s){
case 750:if(this.expression(_={},751)){expr=_.expr; args.push( expr ); }continue
case 751:switch(this.l()){
case',':if(this.c(752)){ this.pushXprToken( args ); }continue
default:this.gr([')','rows','order']);continue
}
case 752:if(this.expression(_={},751)){expr=_.expr; args.push( expr ); }continue
default:
$.outer.push( this.ixprAst( args ) )
return this.exit_()
}
}
orderByClauseAsXpr($,$next){
let args=[]
this.rule_(754,$next)
for(;;)switch(this.s){
case 754:this.orderBySpecAsXpr({args},755);continue
case 755:switch(this.l()){
case',':if(this.c(756)){ this.pushXprToken( args ); }continue
default:this.gr([')']);continue
}
case 756:this.orderBySpecAsXpr({args},755);continue
default:
$.outer.push( this.ixprAst( args ) )
return this.exit_()
}
}
orderBySpecAsXpr($,$next){
let expr;let _
this.rule_(758,$next)
for(;;)switch(this.s){
case 758:if(this.expression(_={},759)){expr=_.expr; $.args.push( expr ); }continue
case 759:switch(this.lk()){
case'asc':case'desc':if(this.ck(760)){ this.pushXprToken( $.args ); }continue
default:this.s=760;continue
}
case 760:switch(this.lk()){
case'nulls':if(this.ck(761)){ this.pushXprToken( $.args ); }continue
default:this.gr([')',',']);continue
}
case 761:switch(this.lk()){
case'last':case'first':if(this.ck(0)){ this.pushXprToken( $.args ); }continue
default:this.e();continue
}
default:return this.exit_()
}
}
windowFrameClause($,$next){
let args=[]
this.rule_(763,$next)
for(;;)switch(this.s){
case 763:switch(this.lk()){
case'unbounded':if(this.ck(764)){ this.pushXprToken( args ); }continue
case'Number':if(this.c(764)){ args.push( this.unsignedIntegerLiteral() ); }continue
case'current':if(this.ck(765)){ this.pushXprToken( args ); }continue
case'between':if(this.ck(766)){ this.pushXprToken( args ); }continue
default:this.e();continue
}
case 764:if(this.mk(0,'preceding')){ this.pushXprToken( args ); }continue
case 765:if(this.mk(0,'row')){ this.pushXprToken( args ); }continue
case 766:this.windowFrameBoundSpec({args},767);continue
case 767:if(this.mk(768,'and')){ this.pushXprToken( args ); }continue
case 768:this.windowFrameBoundSpec({args},0);continue
default:
$.outer.push( this.ixprAst( args ) )
return this.exit_()
}
}
windowFrameBoundSpec($,$next){
this.rule_(770,$next)
for(;;)switch(this.s){
case 770:switch(this.lk()){
case'unbounded':if(this.ck(771)){ this.pushXprToken( $.args ); }continue
case'Number':if(this.c(771)){ $.args.push( this.unsignedIntegerLiteral() ); }continue
case'current':if(this.ck(773)){ this.pushXprToken( $.args ); }continue
default:this.e();continue
}
case 771:switch(this.lk()){
case'following':this.ck(772);continue
case'preceding':this.ck(772);continue
default:this.e();continue
}
case 772:if(this.gr([])){ this.pushXprToken( $.args ); }continue
case 773:if(this.mk(0,'row')){ this.pushXprToken( $.args ); }continue
default:return this.exit_()
}
}
literalValue($,$next){
$.expr??={}
this.rule_(775,$next)
for(;;)switch(this.s){
case 775:switch(this.lk()){
case'#':if(this.c(776)){ this.reportUnexpectedSpace(); }continue
case'null':if(this.ck(0)){ $.expr = { literal: 'null', val: null }; }continue
case'true':case'false':if(this.ck(0)){ $.expr = { literal: 'boolean', val: this.lb().keyword === 'true' }; }continue
case'Number':if(this.c(0)){ $.expr = this.numberLiteral(); }continue
case'String':if(this.c(0)){ $.expr = this.quotedLiteral(); }continue
case'QuotedLiteral':if(this.c(0)){ $.expr = this.quotedLiteral(); }continue
default:this.e();continue
}
case 776:if(this.miA(0,'enumref')){ $.expr = { literal: 'enum', sym: this.identAst() } }continue
default:
this.attachLocation( $.expr )
return this.exit_()
}
}
annoAssignStd($,$next){
this.rule_(778,$next)
for(;;)switch(this.s){
case 778:if(this.m(779,'@')){this.annoInSameLine(); this.reportUnexpectedSpace(); }continue
case 779:switch(this.l()){
case'(':this.annoAssignParen($,0);continue
case'Id':this.annoAssignBase($,0);continue
default:this.e();continue
}
default:
this.docComment( $.art )
return this.exit_()
}
}
annoAssignCol($,$next){
this.rule_(781,$next)
for(;;)switch(this.s){
case 781:if(this.m(782,'@')){ this.reportUnexpectedSpace(); }continue
case 782:switch(this.l()){
case'(':this.annoAssignParen($,0);continue
case'Id':this.annoAssignBase($,0);continue
default:this.e();continue
}
default:
this.docComment( $.art )
return this.exit_()
}
}
annoAssignMid($,$next){
let name;let _
this.rule_(784,$next)
for(;;)switch(this.s){
case 784:if(this.m(785,'@')){this.annoInSameLine(); this.reportUnexpectedSpace(); }continue
case 785:switch(this.l()){
case'(':this.annoAssignParen($,0);continue
case'Id':if(this.annoNamePath(_={category:'anno'},0)){name=_.name; this.assignAnnotation( $.art, {}, name ); this.warnIfColonFollows( name ); }continue
default:this.e();continue
}
default:
this.docComment( $.art )
return this.exit_()
}
}
annoAssignParen($,$next){
this.rule_(787,$next)
for(;;)switch(this.s){
case 787:if(this.m(788,'(')){this.annoInSameLine()}continue;
case 788:switch(this.l()){
case'Id':this.annoAssignBase({art:$.art},789);continue
default:this.s=790;continue
}
case 789:switch(this.l()){
case',':this.c(788);continue
case')':this.s=790;continue
default:this.e();continue
}
case 790:this.m(0,')');continue
default:return this.exit_()
}
}
annoAssignBase($,$next){
let value={}
let name;let _
this.rule_(792,$next)
for(;;)switch(this.s){
case 792:if(this.annoNamePath(_={category:'anno'},793))name=_.name;continue
case 793:switch(this.l()){
case':':this.gc(0,'annoInSameLine')&&this.c(794);continue
default:this.gr([]);continue
}
case 794:if(this.annoValue(_={},0))value=_.value;continue
default:
this.assignAnnotation( $.art, value, name || {} )
return this.exit_()
}
}
annoNamePath($,$next){
$.name??=new XsnName()
let at
this.rule_(796,$next)
for(;;)switch(this.s){
case 796:if(this.miA(797,$.category)){ $.name.path = [ this.identAst() ]; }continue
case 797:switch(this.l()){
case'.':this.c(798);continue
default:this.s=800;continue
}
case 798:switch(this.l()){
case'Id':if(this.ciA(797,$.category)){ $.name.path.push( this.identAst() ); }continue
case'@':if(this.c(799))at=this.lb();continue
default:this.e();continue
}
case 799:if(this.miA(797,$.category)){ $.name.path.push( this.identAstWithPrefix( at ) ); }continue
case 800:switch(this.l()){
case'#':this.gc(0,'annoInSameLine')&&this.annoPathVariant({nameOrRef:$.name},0);continue
default:this.gr([]);continue
}
default:
this.attachLocation( $.name )
return this.exit_()
}
}
annoPath($,$next){
let at
this.rule_(802,$next)
for(;;)switch(this.s){
case 802:switch(this.l()){
case'Id':if(this.ciA(804,$.category)){ $.nameOrRef.path = [ this.identAst() ]; }continue
case'@':if(this.c(803))at=this.lb();continue
default:this.e();continue
}
case 803:if(this.miA(804,$.category)){ $.nameOrRef.path = [ this.identAstWithPrefix( at ) ]; }continue
case 804:switch(this.l()){
case'.':this.c(805);continue
default:this.s=807;continue
}
case 805:switch(this.l()){
case'Id':if(this.ciA(804,$.category)){ $.nameOrRef.path.push( this.identAst() ); }continue
case'@':if(this.c(806))at=this.lb();continue
default:this.e();continue
}
case 806:if(this.miA(804,$.category)){ $.nameOrRef.path.push( this.identAstWithPrefix( at ) ); }continue
case 807:switch(this.l()){
case'#':this.annoPathVariant({nameOrRef:$.nameOrRef},0);continue
default:this.gr([]);continue
}
default:
this.attachLocation( $.nameOrRef )
return this.exit_()
}
}
annoPathVariant($,$next){
this.rule_(809,$next)
for(;;)switch(this.s){
case 809:if(this.m(810,'#')){ this.reportUnexpectedSpace(); }continue
case 810:if(this.miA(811,'variant')){ $.nameOrRef.variant = { path: [ this.identAst() ] }; }continue
case 811:switch(this.l()){
case'.':this.c(812);continue
default:this.gr([]);continue
}
case 812:if(this.miA(811,'variant')){ $.nameOrRef.variant.path.push( this.identAst() ); }continue
default:
this.attachLocation( $.nameOrRef.variant )
return this.exit_()
}
}
annoStructValue($,$next){
$.value??={}
let name=new XsnName()
let _
this.rule_(814,$next)
for(;;)switch(this.s){
case 814:if(this.annoPath({nameOrRef:name,category:'name'},815)){ this.attachLocation( name ); }continue
case 815:switch(this.l()){
case':':this.c(816);continue
default:if(this.gr(['Id',',','@','}'])){ this.attachLocation( $.value ); }continue
}
case 816:if(this.annoValue(_={},0))$.value=_.value;continue
default:
$.value.name = name
return this.exit_()
}
}
annoValue($,$next){
$.value??={}
let sign;let sub;let ellipsis;let upTo;let _
this.rule_(818,$next)
for(;;)switch(this.s){
case 818:switch(this.lk()){
case'#':case'null':case'true':case'false':case'Number':case'String':case'QuotedLiteral':if(this.literalValue(_={},0)){$.value=_.expr; this.adjustAnnoNumber( $.value ); }continue
case'+':case'-':if(this.c(819))sign=this.lb();continue
case'Id':case'@':this.annoPath({nameOrRef:$.value,category:'annoref'},0);continue
case'{':if(this.c(820)){ if (!this.dynamic_.arrayAnno) $.value.$flatten = [];
else { $.value.struct = Object.create(null); $.value.literal = 'struct'; } }continue
case'[':if(this.c(824)){this.arrayAnno(); $.value.val = []; $.value.literal = 'array' }continue
case'(':this.c(831);continue
default:this.ei();continue
}
case 819:if(this.m(0,'Number')){ this.adjustAnnoNumber( $.value = this.numberLiteral( sign ) ); }continue
case 820:switch(this.l()){
case'Id':case'@':if(this.annoStructValue(_={},821)){sub=_.value; if ($.value.$flatten) $.value.$flatten.push( sub );
else this.addDef( sub, $.value, 'struct', null, sub.name ); }continue
default:this.s=822;continue
}
case 821:switch(this.l()){
case',':this.c(820);continue
case'}':this.s=822;continue
case'Id':case'@':this.ec('fail')&&this.g(820);continue
default:this.e();continue
}
case 822:this.s=823;{ this.ec( 'arrayAnno', 'orNotEmpty' ); }continue
case 823:this.m(0,'}');continue
case 824:switch(this.l()){
case'Id':case'#':case'(':case'+':case'-':case'@':case'[':case'{':case'Number':case'String':case'QuotedLiteral':if(this.annoValue(_={},828)){sub=_.value; $.value.val.push( sub ) }continue
case'...':if(this.gc(829,'arrayAnno','ellipsis')&&this.c(825))ellipsis=this.lb();continue
default:this.s=829;continue
}
case 825:switch(this.lk()){
case'up':this.ck(826);continue
default:this.s=828;{ $.value.val.push( { literal: 'token', val: '...', location: ellipsis.location } ); }continue
}
case 826:this.mk(827,'to');continue
case 827:if(this.annoValue(_={},828)){upTo=_.value; $.value.val.push( { literal: 'token', val: '...', location: ellipsis.location, upTo: upTo } ); }continue
case 828:switch(this.l()){
case',':this.c(824);continue
case']':this.s=829;continue
default:this.e();continue
}
case 829:this.s=830;{ this.ec( 'arrayAnno', 'bracket' ); }continue
case 830:this.m(0,']');continue
case 831:if(this.condition(_={},832))$.value=_.expr;continue
case 832:if(this.m(0,')')){ $.value.$tokenTexts = this.ruleTokensText(); }continue
default:
this.attachLocation( $.value )
return this.exit_()
}
}
}
module.exports = { CdlParser }
