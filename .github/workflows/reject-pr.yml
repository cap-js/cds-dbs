name: run tests in cap/dev setup locally

on:
  pull_request:
    types: [opened, reopened, synchronize]

permissions:
  contents: read
  issues: write        # PR comments use the Issues API
  pull-requests: write

jobs:
  fail-fast:
    runs-on: ubuntu-latest

    steps:
      # 1. Drop the instructional comment on the PR
      - name: Post guidance comment
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.pull_request.number }}
          body: |
            ❗️Until cds9 is released, we need to ensure code integrity by local testing.  

            Please follow these steps to run your changes against all tests in our pipeline:
            - Go to [our matrix tests](https://github.tools.sap/cap/.github/actions/workflows/matrix.yml)
            - click **“run workflow”**
            - for **“specific branches for the cds packages”** insert `cds-dbs:${{ github.event.pull_request.head.ref }}` and execute the workflow.  
            Once the matrix tests are green, confirm it here. An admin will then merge your PR.

      # 2. Fail the workflow on purpose
      - name: Fail immediately
        run: |
          echo "Failing intentionally until cds9 release."
          exit 1
